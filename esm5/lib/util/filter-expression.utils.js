var FilterExpressionUtils = (function () {
    function FilterExpressionUtils() {
    }
    FilterExpressionUtils.instanceofBasicExpression = function (arg) {
        return arg.hasOwnProperty(FilterExpressionUtils.BASIC_EXPRESSION_KEY)
            && FilterExpressionUtils.instanceofExpression(arg[FilterExpressionUtils.BASIC_EXPRESSION_KEY]);
    };
    FilterExpressionUtils.buildBasicExpression = function (exp) {
        if (exp) {
            if (!FilterExpressionUtils.instanceofExpression(exp)) {
                console.error('The expression provided is not an instance of \'Expression\'');
            }
            var be = {
                '@basic_expression': exp
            };
            return be;
        }
        return undefined;
    };
    FilterExpressionUtils.instanceofFilterExpression = function (exp) {
        return exp.hasOwnProperty(FilterExpressionUtils.FILTER_EXPRESSION_KEY)
            && FilterExpressionUtils.instanceofExpression(exp[FilterExpressionUtils.FILTER_EXPRESSION_KEY]);
    };
    FilterExpressionUtils.buildFilterExpression = function (exp) {
        if (exp) {
            if (!FilterExpressionUtils.instanceofExpression(exp)) {
                console.error('The expression provided is not an instance of \'Expression\'');
            }
            var be = {
                '@filter_expression': exp
            };
            return be;
        }
        return undefined;
    };
    FilterExpressionUtils.instanceofExpression = function (exp) {
        return exp.hasOwnProperty('lop') && exp.hasOwnProperty('op');
    };
    FilterExpressionUtils.buildComplexExpression = function (expr1, expr2, op) {
        if (expr1.lop === undefined && expr1.op === undefined) {
            return expr2;
        }
        if (expr2.lop === undefined && expr2.op === undefined) {
            return expr1;
        }
        var expr = {
            lop: expr1,
            op: op,
            rop: expr2
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionEquals = function (key, value) {
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_EQUAL,
            rop: value
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionIsNotNull = function (key) {
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_NOT_NULL
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionIsNull = function (key) {
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_NULL
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionLess = function (key, value) {
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_LESS,
            rop: value
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionLessEqual = function (key, value) {
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_LESS_EQUAL,
            rop: value
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionMore = function (key, value) {
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_MORE,
            rop: value
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionMoreEqual = function (key, value) {
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_MORE_EQUAL,
            rop: value
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionIn = function (key, values) {
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_IN,
            rop: values
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionNotLike = function (key, value) {
        if (value !== undefined) {
            value = value.replace(new RegExp('\\*', 'g'), '%');
            if (value.indexOf('%') === -1) {
                value = '%' + value + '%';
            }
        }
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_NOT_LIKE,
            rop: value
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionLike = function (key, value) {
        if (value !== undefined) {
            value = value.replace(new RegExp('\\*', 'g'), '%');
            if (value.indexOf('%') === -1) {
                value = '%' + value + '%';
            }
        }
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_LIKE,
            rop: value
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionLikeEnd = function (key, value) {
        if (value !== undefined) {
            value = '%' + value;
        }
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_LIKE,
            rop: value
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionLikeStart = function (key, value) {
        if (value !== undefined) {
            value = value + '%';
        }
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_LIKE,
            rop: value
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionNotEquals = function (key, value) {
        var expr = {
            lop: key,
            op: FilterExpressionUtils.OP_NOT_EQUAL,
            rop: value
        };
        return expr;
    };
    FilterExpressionUtils.buildExpressionNullAndValue = function (key, value, op) {
        var isNull = FilterExpressionUtils.buildExpressionIsNull(key);
        var equals = FilterExpressionUtils.buildExpressionEquals(key, value);
        var expr = {
            lop: isNull,
            op: op,
            rop: equals
        };
        return expr;
    };
    FilterExpressionUtils.buildArrayExpressionLike = function (keys, value) {
        var result = {
            lop: undefined,
            op: undefined
        };
        keys.forEach(function (col) {
            result = FilterExpressionUtils.stackExpressionLikeOR(col, value, result);
        });
        return result;
    };
    FilterExpressionUtils.buildExpressionFromObject = function (obj) {
        var result = {
            lop: undefined,
            op: undefined
        };
        Object.keys(obj || {}).forEach(function (key) {
            result = FilterExpressionUtils.stackExpressionEqualsAND(key, obj[key], result);
        });
        return result;
    };
    FilterExpressionUtils.stackExpressionLikeOR = function (key, value, expr) {
        var likeExpr = FilterExpressionUtils.buildExpressionLike(key, value);
        if (expr.lop === undefined && expr.op === undefined) {
            return likeExpr;
        }
        else {
            expr = FilterExpressionUtils.buildComplexExpression(expr, likeExpr, FilterExpressionUtils.OP_OR);
        }
        return expr;
    };
    FilterExpressionUtils.stackExpressionEqualsAND = function (key, value, expr) {
        var equalsExpr = FilterExpressionUtils.buildExpressionEquals(key, value);
        if (expr.lop === undefined && expr.op === undefined) {
            return equalsExpr;
        }
        else {
            expr = FilterExpressionUtils.buildComplexExpression(expr, equalsExpr, FilterExpressionUtils.OP_AND);
        }
        return expr;
    };
    FilterExpressionUtils.BASIC_EXPRESSION_KEY = '@basic_expression';
    FilterExpressionUtils.FILTER_EXPRESSION_KEY = '@filter_expression';
    FilterExpressionUtils.OP_OR = 'OR';
    FilterExpressionUtils.OP_AND = 'AND';
    FilterExpressionUtils.OP_LIKE = 'LIKE';
    FilterExpressionUtils.OP_NOT_LIKE = 'NOT LIKE';
    FilterExpressionUtils.OP_EQUAL = '=';
    FilterExpressionUtils.OP_NOT_EQUAL = '<>';
    FilterExpressionUtils.OP_NULL = 'IS NULL';
    FilterExpressionUtils.OP_NOT_NULL = 'IS NOT NULL';
    FilterExpressionUtils.OP_LESS = '<';
    FilterExpressionUtils.OP_LESS_EQUAL = '<=';
    FilterExpressionUtils.OP_MORE = '>';
    FilterExpressionUtils.OP_MORE_EQUAL = '>=';
    FilterExpressionUtils.OP_IN = 'IN';
    return FilterExpressionUtils;
}());
export { FilterExpressionUtils };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLWV4cHJlc3Npb24udXRpbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9vbnRpbWl6ZS13ZWItbmd4LyIsInNvdXJjZXMiOlsibGliL3V0aWwvZmlsdGVyLWV4cHJlc3Npb24udXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBT0E7SUFBQTtJQTBiQSxDQUFDO0lBeFdRLCtDQUF5QixHQUFoQyxVQUFpQyxHQUFRO1FBQ3ZDLE9BQU8sR0FBRyxDQUFDLGNBQWMsQ0FBQyxxQkFBcUIsQ0FBQyxvQkFBb0IsQ0FBQztlQUNoRSxxQkFBcUIsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO0lBQ25HLENBQUM7SUFPTSwwQ0FBb0IsR0FBM0IsVUFBNEIsR0FBZTtRQUN6QyxJQUFJLEdBQUcsRUFBRTtZQUNQLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDcEQsT0FBTyxDQUFDLEtBQUssQ0FBQyw4REFBOEQsQ0FBQyxDQUFDO2FBQy9FO1lBQ0QsSUFBTSxFQUFFLEdBQW9CO2dCQUMxQixtQkFBbUIsRUFBRSxHQUFHO2FBQ3pCLENBQUM7WUFDRixPQUFPLEVBQUUsQ0FBQztTQUNYO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQU9NLGdEQUEwQixHQUFqQyxVQUFrQyxHQUFRO1FBQ3hDLE9BQU8sR0FBRyxDQUFDLGNBQWMsQ0FBQyxxQkFBcUIsQ0FBQyxxQkFBcUIsQ0FBQztlQUNqRSxxQkFBcUIsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMscUJBQXFCLENBQUMsQ0FBQyxDQUFDO0lBQ3BHLENBQUM7SUFPTSwyQ0FBcUIsR0FBNUIsVUFBNkIsR0FBZTtRQUMxQyxJQUFJLEdBQUcsRUFBRTtZQUNQLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsRUFBRTtnQkFDcEQsT0FB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dEIsbUNBQWEsR0FBVyxJQUFJLENBQUM7SUFLN0IsMkJBQUssR0FBVyxJQUFJLENBQUM7SUErVzlCLDRCQUFDO0NBQUEsQUExYkQsSUEwYkM7U0ExYlkscUJBQXFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmFzaWNFeHByZXNzaW9uIH0gZnJvbSAnLi4vdHlwZXMvYmFzaWMtZXhwcmVzc2lvbi50eXBlJztcbmltcG9ydCB7IEV4cHJlc3Npb24gfSBmcm9tICcuLi90eXBlcy9leHByZXNzaW9uLnR5cGUnO1xuaW1wb3J0IHsgRmlsdGVyRXhwcmVzc2lvbiB9IGZyb20gJy4uL3R5cGVzL2ZpbHRlci1leHByZXNzaW9uLnR5cGUnO1xuXG4vKipcbiAqIFV0aWxpdHkgY2xhc3MgZm9yIGJ1aWxkaW5nIGJhc2ljIGFuZCBmaWx0ZXIgZXhwcmVzc2lvbnMuXG4gKi9cbmV4cG9ydCBjbGFzcyBGaWx0ZXJFeHByZXNzaW9uVXRpbHMge1xuXG4gIC8qKlxuICAgKiBUaGUgYmFzaWMgZXhwcmVzaW9uIGtleS5cbiAgICovXG4gIHN0YXRpYyBCQVNJQ19FWFBSRVNTSU9OX0tFWSA9ICdAYmFzaWNfZXhwcmVzc2lvbic7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWx0ZXIgZXhwcmVzaW9uIGtleS5cbiAgICovXG4gIHN0YXRpYyBGSUxURVJfRVhQUkVTU0lPTl9LRVkgPSAnQGZpbHRlcl9leHByZXNzaW9uJztcblxuICAvKipcbiAgICogVGhlIGBPUmAgb3BlcmF0b3IuXG4gICAqL1xuICBzdGF0aWMgT1BfT1I6IHN0cmluZyA9ICdPUic7XG5cbiAgLyoqXG4gICAqIFRoZSBgQU5EYCBvcGVyYXRvci5cbiAgICovXG4gIHN0YXRpYyBPUF9BTkQ6IHN0cmluZyA9ICdBTkQnO1xuXG4gIC8qKlxuICAgKiBUaGUgYExJS0VgIG9wZXJhdG9yXG4gICAqL1xuICBzdGF0aWMgT1BfTElLRTogc3RyaW5nID0gJ0xJS0UnO1xuXG4gIC8qKlxuICAgKiBUaGUgYE5PVCBMSUtFYCBvcGVyYXRvci5cbiAgICovXG4gIHN0YXRpYyBPUF9OT1RfTElLRTogc3RyaW5nID0gJ05PVCBMSUtFJztcblxuICAvKipcbiAgICogVGhlIGBFUVVBTGAgb3BlcmF0b3IuXG4gICAqL1xuICBzdGF0aWMgT1BfRVFVQUw6IHN0cmluZyA9ICc9JztcblxuICAvKipcbiAgICogVGhlIGBOT1QgRVFVQUxgIG9wZXJhdG9yLlxuICAgKi9cbiAgc3RhdGljIE9QX05PVF9FUVVBTDogc3RyaW5nID0gJzw+JztcblxuICAvKipcbiAgICogVGhlIGBJUyBOVUxMYCBvcGVyYXRvci5cbiAgICovXG4gIHN0YXRpYyBPUF9OVUxMOiBzdHJpbmcgPSAnSVMgTlVMTCc7XG5cbiAgLyoqXG4gICAqIFRoZSBgSVMgTk9UIE5VTExgIG9wZXJhdG9yLlxuICAgKi9cbiAgc3RhdGljIE9QX05PVF9OVUxMOiBzdHJpbmcgPSAnSVMgTk9UIE5VTEwnO1xuXG4gIC8qKlxuICAgKiBUaGUgYExFU1NgIG9wZXJhdG9yLlxuICAgKi9cbiAgc3RhdGljIE9QX0xFU1M6IHN0cmluZyA9ICc8JztcblxuICAvKipcbiAgICogVGhlIGBMRVMgRVFVQUxgIG9wZXJhdG9yLlxuICAgKi9cbiAgc3RhdGljIE9QX0xFU1NfRVFVQUw6IHN0cmluZyA9ICc8PSc7XG5cbiAgLyoqXG4gICAqIFRoZSBgTU9SRWAgb3BlcmF0b3IuXG4gICAqL1xuICBzdGF0aWMgT1BfTU9SRTogc3RyaW5nID0gJz4nO1xuXG4gIC8qKlxuICAgKiBUaGUgYE1PUkUgRVFVQUxgIG9wZXJhdG9yLlxuICAgKi9cbiAgc3RhdGljIE9QX01PUkVfRVFVQUw6IHN0cmluZyA9ICc+PSc7XG5cbiAgLyoqXG4gICAqIFRoZSBgSU5gIG9wZXJhdG9yLlxuICAgKi9cbiAgc3RhdGljIE9QX0lOOiBzdHJpbmcgPSAnSU4nO1xuXG4gIC8qKlxuICAgKiBFdmFsdWF0ZXMgaWYgdGhlIHRoZSBleHByZXNzaW9uIHByb3ZpZGVkIGlzIGFuIGluc3RhbmNlIG9mIGBCYXNpY0V4cHJlc3Npb25gLi5cbiAgICogQHBhcmFtIGFyZyB0aGUgZXhwcmVzc2lvbiB0byBldmFsdWF0ZS5cbiAgICogQHJldHVybnMgYHRydWVgIGlmIHRoZSBwcm92aWRlZCBleHByZXNzaW9uIGlzIGFuIGluc3RhbmNlIG9mIGBCYXNpY0V4cHJlc3Npb25gLCBgZmFsc2VgIG90aGVyd2lzZS5cbiAgICovXG4gIHN0YXRpYyBpbnN0YW5jZW9mQmFzaWNFeHByZXNzaW9uKGFyZzogYW55KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGFyZy5oYXNPd25Qcm9wZXJ0eShGaWx0ZXJFeHByZXNzaW9uVXRpbHMuQkFTSUNfRVhQUkVTU0lPTl9LRVkpXG4gICAgICAmJiBGaWx0ZXJFeHByZXNzaW9uVXRpbHMuaW5zdGFuY2VvZkV4cHJlc3Npb24oYXJnW0ZpbHRlckV4cHJlc3Npb25VdGlscy5CQVNJQ19FWFBSRVNTSU9OX0tFWV0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkcyBhIGBCYXNpY0V4cHJlc3Npb25gIGluc3RhbmNlIGZyb20gdGhlIGZpbHRlcmluZyBleHByZXNzaW9uIChgRXhwcmVzc2lvbmApIHByb3ZpZGVkLlxuICAgKiBAcGFyYW0gZXhwIHRoZSBmaWx0ZXJpbmcgZXhwcmVzc2lvbi5cbiAgICogQHJldHVybnMgdGhlIGJhc2ljIGV4cHJlc3Npb24uXG4gICAqL1xuICBzdGF0aWMgYnVpbGRCYXNpY0V4cHJlc3Npb24oZXhwOiBFeHByZXNzaW9uKTogQmFzaWNFeHByZXNzaW9uIHtcbiAgICBpZiAoZXhwKSB7XG4gICAgICBpZiAoIUZpbHRlckV4cHJlc3Npb25VdGlscy5pbnN0YW5jZW9mRXhwcmVzc2lvbihleHApKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RoZSBleHByZXNzaW9uIHByb3ZpZGVkIGlzIG5vdCBhbiBpbnN0YW5jZSBvZiBcXCdFeHByZXNzaW9uXFwnJyk7XG4gICAgICB9XG4gICAgICBjb25zdCBiZTogQmFzaWNFeHByZXNzaW9uID0ge1xuICAgICAgICAnQGJhc2ljX2V4cHJlc3Npb24nOiBleHBcbiAgICAgIH07XG4gICAgICByZXR1cm4gYmU7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogRXZhbHVhdGVzIGlmIGFuIGV4cHJlc2lvbiBpcyBpbnN0YW5jZSBvZiBgRmlsdGVyRXhwcmVzc2lvbmAuXG4gICAqIEBwYXJhbSBleHAgdGhlIGV4cHJlc3Npb24gdG8gZXZhbHVhdGUuXG4gICAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgcHJvdmlkZWQgZXhwcmVzc2lvbiBpcyBhbiBpbnN0YW5jZSBvZiBgRmlsdGVyRXhwcmVzc2lvbmAsIGBmYWxzZWAgb3RoZXJ3aXNlLlxuICAgKi9cbiAgc3RhdGljIGluc3RhbmNlb2ZGaWx0ZXJFeHByZXNzaW9uKGV4cDogYW55KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGV4cC5oYXNPd25Qcm9wZXJ0eShGaWx0ZXJFeHByZXNzaW9uVXRpbHMuRklMVEVSX0VYUFJFU1NJT05fS0VZKVxuICAgICAgJiYgRmlsdGVyRXhwcmVzc2lvblV0aWxzLmluc3RhbmNlb2ZFeHByZXNzaW9uKGV4cFtGaWx0ZXJFeHByZXNzaW9uVXRpbHMuRklMVEVSX0VYUFJFU1NJT05fS0VZXSk7XG4gIH1cblxuICAvKipcbiAgICogQnVpbGRzIGFuIGBGaWx0ZXJFeHByZXNzaW9uYCBpbnN0YW5jZSBmcm9tIHRoZSBmaWx0ZXJpbmcgZXhwcmVzc2lvbiAoYEV4cHJlc3Npb25gKSBwcm92aWRlZC5cbiAgICogQHBhcmFtIGV4cCB0aGUgZmlsdGVyaW5nIGV4cHJlc3Npb24uXG4gICAqIEByZXR1cm5zIHRoZSBgRmlsdGVyRXhwcmVzc2lvbmAuXG4gICAqL1xuICBzdGF0aWMgYnVpbGRGaWx0ZXJFeHByZXNzaW9uKGV4cDogRXhwcmVzc2lvbik6IEZpbHRlckV4cHJlc3Npb24ge1xuICAgIGlmIChleHApIHtcbiAgICAgIGlmICghRmlsdGVyRXhwcmVzc2lvblV0aWxzLmluc3RhbmNlb2ZFeHByZXNzaW9uKGV4cCkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignVGhlIGV4cHJlc3Npb24gcHJvdmlkZWQgaXMgbm90IGFuIGluc3RhbmNlIG9mIFxcJ0V4cHJlc3Npb25cXCcnKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGJlOiBGaWx0ZXJFeHByZXNzaW9uID0ge1xuICAgICAgICAnQGZpbHRlcl9leHByZXNzaW9uJzogZXhwXG4gICAgICB9O1xuICAgICAgcmV0dXJuIGJlO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgLyoqXG4gICAqIEV2YWx1YXRlcyBpZiBhbiBleHByZXNpb24gaXMgaW5zdGFuY2Ugb2YgYEV4cHJlc3Npb25gLlxuICAgKiBAcGFyYW0gZXhwIHRoZSBleHByZXNzaW9uIHRvIGV2YWx1YXRlLlxuICAgKiBAcmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHByb3ZpZGVkIGV4cHJlc3Npb24gaXMgYW4gaW5zdGFuY2Ugb2YgYEV4cHJlc3Npb25gLCBgZmFsc2VgIG90aGVyd2lzZS5cbiAgICovXG4gIHN0YXRpYyBpbnN0YW5jZW9mRXhwcmVzc2lvbihleHA6IGFueSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBleHAuaGFzT3duUHJvcGVydHkoJ2xvcCcpICYmIGV4cC5oYXNPd25Qcm9wZXJ0eSgnb3AnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZHMgYSBjb21wbGV4IGBFeHByZXNzaW9uYCBpbnN0YW5jZSBqb2luaW5nIHR3byBleHByZXNzaW9ucyB3aXRoIHRoZSBwcm92aWRlZCBvcGVyYXRvci5cbiAgICogQHBhcmFtIGV4cHIxIHRoZSBmaXJzdCBgRXhwcmVzc2lvbmAgdG8gam9pbi5cbiAgICogQHBhcmFtIGV4cHIyIHRoZSBzZWNvbmQgYEV4cHJlc3Npb25gIHRvIGpvaW4uXG4gICAqIEBwYXJhbSBvcCB0aGUgam9pbmluZyBvcGVyYXRvci5cbiAgICogQHJldHVybnMgdGhlIGNvbXBsZXggYEV4cHJlc3Npb25gLlxuICAgKi9cbiAgc3RhdGljIGJ1aWxkQ29tcGxleEV4cHJlc3Npb24oZXhwcjE6IEV4cHJlc3Npb24sIGV4cHIyOiBFeHByZXNzaW9uLCBvcDogc3RyaW5nKTogRXhwcmVzc2lvbiB7XG4gICAgaWYgKGV4cHIxLmxvcCA9PT0gdW5kZWZpbmVkICYmIGV4cHIxLm9wID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBleHByMjtcbiAgICB9XG4gICAgaWYgKGV4cHIyLmxvcCA9PT0gdW5kZWZpbmVkICYmIGV4cHIyLm9wID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBleHByMTtcbiAgICB9XG4gICAgY29uc3QgZXhwcjogRXhwcmVzc2lvbiA9IHtcbiAgICAgIGxvcDogZXhwcjEsXG4gICAgICBvcDogb3AsXG4gICAgICByb3A6IGV4cHIyXG4gICAgfTtcbiAgICByZXR1cm4gZXhwcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZHMgYW4gYEV4cHJlc3Npb25gIGluc3RhbmNlIGZvciBmaWx0ZXJpbmcgdGhlIHByb3ZpZGVkIGtleSBFUVVBTCB0byB0aGUgcHJvdmlkZWQgdmFsdWUuXG4gICAqIEBwYXJhbSBrZXkgdGhlIGtleS5cbiAgICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZS5cbiAgICogQHJldHVybnMgdGhlIGBFeHByZXNzaW9uYC5cbiAgICovXG4gIHN0YXRpYyBidWlsZEV4cHJlc3Npb25FcXVhbHMoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpOiBFeHByZXNzaW9uIHtcbiAgICBjb25zdCBleHByOiBFeHByZXNzaW9uID0ge1xuICAgICAgbG9wOiBrZXksXG4gICAgICBvcDogRmlsdGVyRXhwcmVzc2lvblV0aWxzLk9QX0VRVUFMLFxuICAgICAgcm9wOiB2YWx1ZVxuICAgIH07XG4gICAgcmV0dXJuIGV4cHI7XG4gIH1cblxuICAvKipcbiAgICogQnVpbGRzIGFuIGBFeHByZXNzaW9uYCBpbnN0YW5jZSBmb3IgZmlsdGVyaW5nIHRoZSBwcm92aWRlZCBrZXkgd2l0aCBhIE5PVCBOVUxMIHZhbHVlLlxuICAgKiBAcGFyYW0ga2V5IHRoZSBrZXkuXG4gICAqIEByZXR1cm5zIHRoZSBgRXhwcmVzc2lvbmAuXG4gICAqL1xuICBzdGF0aWMgYnVpbGRFeHByZXNzaW9uSXNOb3ROdWxsKGtleTogc3RyaW5nKTogRXhwcmVzc2lvbiB7XG4gICAgY29uc3QgZXhwcjogRXhwcmVzc2lvbiA9IHtcbiAgICAgIGxvcDoga2V5LFxuICAgICAgb3A6IEZpbHRlckV4cHJlc3Npb25VdGlscy5PUF9OT1RfTlVMTFxuICAgIH07XG4gICAgcmV0dXJuIGV4cHI7XG4gIH1cblxuICAvKipcbiAgICogQnVpbGRzIGFuIGBFeHByZXNzaW9uYCBpbnN0YW5jZSBmb3IgZmlsdGVyaW5nIHRoZSBwcm92aWRlZCBrZXkgd2l0aCBhIE5VTEwgdmFsdWUuXG4gICAqIEBwYXJhbSBrZXkgdGhlIGtleS5cbiAgICogQHJldHVybnMgdGhlIGBFeHByZXNzaW9uYC5cbiAgICovXG4gIHN0YXRpYyBidWlsZEV4cHJlc3Npb25Jc051bGwoa2V5OiBzdHJpbmcpOiBFeHByZXNzaW9uIHtcbiAgICBjb25zdCBleHByOiBFeHByZXNzaW9uID0ge1xuICAgICAgbG9wOiBrZXksXG4gICAgICBvcDogRmlsdGVyRXhwcmVzc2lvblV0aWxzLk9QX05VTExcbiAgICB9O1xuICAgIHJldHVybiBleHByO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkcyBhbiBgRXhwcmVzc2lvbmAgaW5zdGFuY2UgZm9yIGZpbHRlcmluZyB0aGUgcHJvdmlkZWQga2V5IExFU1MgdGhhbiB0aGUgcHJvdmlkZWQgdmFsdWUuXG4gICAqIEBwYXJhbSBrZXkgdGhlIGtleS5cbiAgICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZS5cbiAgICogQHJldHVybnMgdGhlIGBFeHByZXNzaW9uYC5cbiAgICovXG4gIHN0YXRpYyBidWlsZEV4cHJlc3Npb25MZXNzKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KTogRXhwcmVzc2lvbiB7XG4gICAgY29uc3QgZXhwcjogRXhwcmVzc2lvbiA9IHtcbiAgICAgIGxvcDoga2V5LFxuICAgICAgb3A6IEZpbHRlckV4cHJlc3Npb25VdGlscy5PUF9MRVNTLFxuICAgICAgcm9wOiB2YWx1ZVxuICAgIH07XG4gICAgcmV0dXJuIGV4cHI7XG4gIH1cblxuICAvKipcbiAgICogQnVpbGRzIGFuIGBFeHByZXNzaW9uYCBpbnN0YW5jZSBmb3IgZmlsdGVyaW5nIHRoZSBwcm92aWRlZCBrZXkgTEVTUyBPUiBFUVVBTCB0byB0aGUgcHJvdmlkZWQgdmFsdWUuXG4gICAqIEBwYXJhbSBrZXkgdGhlIGtleS5cbiAgICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZS5cbiAgICogQHJldHVybnMgdGhlIGBFeHByZXNzaW9uYC5cbiAgICovXG4gIHN0YXRpYyBidWlsZEV4cHJlc3Npb25MZXNzRXF1YWwoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnkpOiBFeHByZXNzaW9uIHtcbiAgICBjb25zdCBleHByOiBFeHByZXNzaW9uID0ge1xuICAgICAgbG9wOiBrZXksXG4gICAgICBvcDogRmlsdGVyRXhwcmVzc2lvblV0aWxzLk9QX0xFU1NfRVFVQUwsXG4gICAgICByb3A6IHZhbHVlXG4gICAgfTtcbiAgICByZXR1cm4gZXhwcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZHMgYW4gYEV4cHJlc3Npb25gIGluc3RhbmNlIGZvciBmaWx0ZXJpbmcgdGhlIHByb3ZpZGVkIGtleSBNT1JFIHRoYW4gdGhlIHByb3ZpZGVkIHZhbHVlLlxuICAgKiBAcGFyYW0ga2V5IHRoZSBrZXkuXG4gICAqIEBwYXJhbSB2YWx1ZSB0aGUgdmFsdWUuXG4gICAqIEByZXR1cm5zIHRoZSBgRXhwcmVzc2lvbmAuXG4gICAqL1xuICBzdGF0aWMgYnVpbGRFeHByZXNzaW9uTW9yZShrZXk6IHN0cmluZywgdmFsdWU6IGFueSk6IEV4cHJlc3Npb24ge1xuICAgIGNvbnN0IGV4cHI6IEV4cHJlc3Npb24gPSB7XG4gICAgICBsb3A6IGtleSxcbiAgICAgIG9wOiBGaWx0ZXJFeHByZXNzaW9uVXRpbHMuT1BfTU9SRSxcbiAgICAgIHJvcDogdmFsdWVcbiAgICB9O1xuICAgIHJldHVybiBleHByO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkcyBhbiBgRXhwcmVzc2lvbmAgaW5zdGFuY2UgZm9yIGZpbHRlcmluZyB0aGUgcHJvdmlkZWQga2V5IE1PUkUgT1IgRVFVQUwgdG8gdGhlIHByb3ZpZGVkIHZhbHVlLlxuICAgKiBAcGFyYW0ga2V5IHRoZSBrZXkuXG4gICAqIEBwYXJhbSB2YWx1ZSB0aGUgdmFsdWUuXG4gICAqIEByZXR1cm5zIHRoZSBgRXhwcmVzc2lvbmAuXG4gICAqL1xuICBzdGF0aWMgYnVpbGRFeHByZXNzaW9uTW9yZUVxdWFsKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KTogRXhwcmVzc2lvbiB7XG4gICAgY29uc3QgZXhwcjogRXhwcmVzc2lvbiA9IHtcbiAgICAgIGxvcDoga2V5LFxuICAgICAgb3A6IEZpbHRlckV4cHJlc3Npb25VdGlscy5PUF9NT1JFX0VRVUFMLFxuICAgICAgcm9wOiB2YWx1ZVxuICAgIH07XG4gICAgcmV0dXJuIGV4cHI7XG4gIH1cblxuICBzdGF0aWMgYnVpbGRFeHByZXNzaW9uSW4oa2V5OiBzdHJpbmcsIHZhbHVlczogYW55W10pOiBFeHByZXNzaW9uIHtcbiAgICBjb25zdCBleHByOiBFeHByZXNzaW9uID0ge1xuICAgICAgbG9wOiBrZXksXG4gICAgICBvcDogRmlsdGVyRXhwcmVzc2lvblV0aWxzLk9QX0lOLFxuICAgICAgcm9wOiB2YWx1ZXNcbiAgICB9O1xuICAgIHJldHVybiBleHByO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkcyBhbiBgRXhwcmVzc2lvbmAgaW5zdGFuY2UgZm9yIGZpbHRlcmluZyB0aGUgcHJvdmlkZWQga2V5IE5PVCBMSUtFIHRoZSBwcm92aWRlZCB2YWx1ZS5cbiAgICogQHBhcmFtIGtleSB0aGUga2V5LlxuICAgKiBAcGFyYW0gdmFsdWUgdGhlIHZhbHVlLlxuICAgKiBAcmV0dXJucyB0aGUgYEV4cHJlc3Npb25gLlxuICAgKi9cbiAgc3RhdGljIGJ1aWxkRXhwcmVzc2lvbk5vdExpa2Uoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpOiBFeHByZXNzaW9uIHtcbiAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKG5ldyBSZWdFeHAoJ1xcXFwqJywgJ2cnKSwgJyUnKTtcbiAgICAgIGlmICh2YWx1ZS5pbmRleE9mKCclJykgPT09IC0xKSB7XG4gICAgICAgIHZhbHVlID0gJyUnICsgdmFsdWUgKyAnJSc7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGV4cHI6IEV4cHJlc3Npb24gPSB7XG4gICAgICBsb3A6IGtleSxcbiAgICAgIG9wOiBGaWx0ZXJFeHByZXNzaW9uVXRpbHMuT1BfTk9UX0xJS0UsXG4gICAgICByb3A6IHZhbHVlXG4gICAgfTtcbiAgICByZXR1cm4gZXhwcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZHMgYW4gYEV4cHJlc3Npb25gIGluc3RhbmNlIGZvciBmaWx0ZXJpbmcgdGhlIHByb3ZpZGVkIGtleSBMSUtFIHRoZSBwcm92aWRlZCB2YWx1ZS5cbiAgICogQHBhcmFtIGtleSB0aGUga2V5LlxuICAgKiBAcGFyYW0gdmFsdWUgdGhlIHZhbHVlLlxuICAgKiBAcmV0dXJucyB0aGUgYEV4cHJlc3Npb25gLlxuICAgKi9cbiAgc3RhdGljIGJ1aWxkRXhwcmVzc2lvbkxpa2Uoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpOiBFeHByZXNzaW9uIHtcbiAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKG5ldyBSZWdFeHAoJ1xcXFwqJywgJ2cnKSwgJyUnKTtcbiAgICAgIGlmICh2YWx1ZS5pbmRleE9mKCclJykgPT09IC0xKSB7XG4gICAgICAgIHZhbHVlID0gJyUnICsgdmFsdWUgKyAnJSc7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGV4cHI6IEV4cHJlc3Npb24gPSB7XG4gICAgICBsb3A6IGtleSxcbiAgICAgIG9wOiBGaWx0ZXJFeHByZXNzaW9uVXRpbHMuT1BfTElLRSxcbiAgICAgIHJvcDogdmFsdWVcbiAgICB9O1xuICAgIHJldHVybiBleHByO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkcyBhbiBgRXhwcmVzc2lvbmAgaW5zdGFuY2UgZm9yIGZpbHRlcmluZyB0aGUgcHJvdmlkZWQga2V5IEVORFMgTElLRSB0aGUgcHJvdmlkZWQgdmFsdWUuXG4gICAqIEBwYXJhbSBrZXkgdGhlIGtleS5cbiAgICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZS5cbiAgICogQHJldHVybnMgdGhlIGBFeHByZXNzaW9uYC5cbiAgICovXG4gIHN0YXRpYyBidWlsZEV4cHJlc3Npb25MaWtlRW5kKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nKTogRXhwcmVzc2lvbiB7XG4gICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHZhbHVlID0gJyUnICsgdmFsdWU7XG4gICAgfVxuICAgIGNvbnN0IGV4cHI6IEV4cHJlc3Npb24gPSB7XG4gICAgICBsb3A6IGtleSxcbiAgICAgIG9wOiBGaWx0ZXJFeHByZXNzaW9uVXRpbHMuT1BfTElLRSxcbiAgICAgIHJvcDogdmFsdWVcbiAgICB9O1xuICAgIHJldHVybiBleHByO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkcyBhbiBgRXhwcmVzc2lvbmAgaW5zdGFuY2UgZm9yIGZpbHRlcmluZyB0aGUgcHJvdmlkZWQga2V5IFNUQVJUUyBMSUtFIHRoZSBwcm92aWRlZCB2YWx1ZS5cbiAgICogQHBhcmFtIGtleSB0aGUga2V5LlxuICAgKiBAcGFyYW0gdmFsdWUgdGhlIHZhbHVlLlxuICAgKiBAcmV0dXJucyB0aGUgYEV4cHJlc3Npb25gLlxuICAgKi9cbiAgc3RhdGljIGJ1aWxkRXhwcmVzc2lvbkxpa2VTdGFydChrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyk6IEV4cHJlc3Npb24ge1xuICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB2YWx1ZSA9IHZhbHVlICsgJyUnO1xuICAgIH1cbiAgICBjb25zdCBleHByOiBFeHByZXNzaW9uID0ge1xuICAgICAgbG9wOiBrZXksXG4gICAgICBvcDogRmlsdGVyRXhwcmVzc2lvblV0aWxzLk9QX0xJS0UsXG4gICAgICByb3A6IHZhbHVlXG4gICAgfTtcbiAgICByZXR1cm4gZXhwcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZHMgYW4gYEV4cHJlc3Npb25gIGluc3RhbmNlIGZvciBmaWx0ZXJpbmcgdGhlIHByb3ZpZGVkIGtleSBOT1QgRVFVQUwgdGhlIHByb3ZpZGVkIHZhbHVlLlxuICAgKiBAcGFyYW0ga2V5IHRoZSBrZXkuXG4gICAqIEBwYXJhbSB2YWx1ZSB0aGUgdmFsdWUuXG4gICAqIEByZXR1cm5zIHRoZSBgRXhwcmVzc2lvbmAuXG4gICAqL1xuICBzdGF0aWMgYnVpbGRFeHByZXNzaW9uTm90RXF1YWxzKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KTogRXhwcmVzc2lvbiB7XG4gICAgY29uc3QgZXhwcjogRXhwcmVzc2lvbiA9IHtcbiAgICAgIGxvcDoga2V5LFxuICAgICAgb3A6IEZpbHRlckV4cHJlc3Npb25VdGlscy5PUF9OT1RfRVFVQUwsXG4gICAgICByb3A6IHZhbHVlXG4gICAgfTtcbiAgICByZXR1cm4gZXhwcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWlsZHMgYSBjb21wbGV4IGBFeHByZXNzaW9uYCBmb3IgZmlsdGVyaW5nIHRoZSBwcm92aWRlZCBrZXkgd2l0aCB0d28gY29uZGl0aW9uczpcbiAgICogKiBUaGUgZmlyc3QgZmlsdGVyIHRoZSBwcm92aWRlZCBrZXkgd2l0aCBhIE5VTEwgdmFsdWUuXG4gICAqICogVGhlIHNlY29uZCBmaWx0ZXIgdGhlIHByb3ZpZGVkIGtleSBFUVVBTCB0byB0aGUgcHJvdmlkZWQgdmFsdWUuXG4gICAqXG4gICAqIEJvdGggZXhwcmVzc2lvbnMgYXJlIGpvaW5lZCB1c2luZyB0aGUgcHJvdmlkZWQgb3BlcmF0b3IuXG4gICAqIEBwYXJhbSBrZXkgdGhlIGtleS5cbiAgICogQHBhcmFtIHZhbHVlIHRoZSB2YWx1ZS5cbiAgICogQHBhcmFtIG9wIHRoZSBvcGVyYXRvci5cbiAgICogQHJldHVybnMgdGhlIGBFeHByZXNzaW9uYC5cbiAgICovXG4gIHN0YXRpYyBidWlsZEV4cHJlc3Npb25OdWxsQW5kVmFsdWUoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIG9wOiBzdHJpbmcpOiBFeHByZXNzaW9uIHtcbiAgICBjb25zdCBpc051bGw6IEV4cHJlc3Npb24gPSBGaWx0ZXJFeHByZXNzaW9uVXRpbHMuYnVpbGRFeHByZXNzaW9uSXNOdWxsKGtleSk7XG4gICAgY29uc3QgZXF1YWxzOiBFeHByZXNzaW9uID0gRmlsdGVyRXhwcmVzc2lvblV0aWxzLmJ1aWxkRXhwcmVzc2lvbkVxdWFscyhrZXksIHZhbHVlKTtcbiAgICBjb25zdCBleHByOiBFeHByZXNzaW9uID0ge1xuICAgICAgbG9wOiBpc051bGwsXG4gICAgICBvcDogb3AsXG4gICAgICByb3A6IGVxdWFsc1xuICAgIH07XG4gICAgcmV0dXJuIGV4cHI7XG4gIH1cblxuICAvKipcbiAgICogQnVpbGRzIGEgY29tcGxleCBgRXhwcmVzc2lvbmAgZm9yIGZpbHRlcmluZyB0aGUgcHJvdmlkZWQga2V5cyBMSUtFIHRoZSB2YWx1ZSBwcm92aWRlZC5cbiAgICogQHBhcmFtIGtleXMgdGhlIGtleXMuXG4gICAqIEBwYXJhbSB2YWx1ZSB0aGUgdmFsdWUuXG4gICAqIEByZXR1cm5zIHRoZSBgRXhwcmVzc2lvbmAuXG4gICAqL1xuICBzdGF0aWMgYnVpbGRBcnJheUV4cHJlc3Npb25MaWtlKGtleXM6IGFueVtdLCB2YWx1ZTogYW55KTogRXhwcmVzc2lvbiB7XG4gICAgbGV0IHJlc3VsdDogRXhwcmVzc2lvbiA9IHtcbiAgICAgIGxvcDogdW5kZWZpbmVkLFxuICAgICAgb3A6IHVuZGVmaW5lZFxuICAgIH07XG4gICAga2V5cy5mb3JFYWNoKChjb2wpID0+IHtcbiAgICAgIHJlc3VsdCA9IEZpbHRlckV4cHJlc3Npb25VdGlscy5zdGFja0V4cHJlc3Npb25MaWtlT1IoY29sLCB2YWx1ZSwgcmVzdWx0KTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkcyBhbiBgRXhwcmVzc2lvbmAgaW5zdGFuY2UgZnJvbSB0aGUgcHJvdmlkZWQgb2JqZWN0LlxuICAgKiBAcGFyYW0gb2JqIHRoZSBvYmplY3QuXG4gICAqIEByZXR1cm5zIHRoZSBgRXhwcmVzc2lvbmAuXG4gICAqL1xuICBzdGF0aWMgYnVpbGRFeHByZXNzaW9uRnJvbU9iamVjdChvYmo6IGFueSk6IEV4cHJlc3Npb24ge1xuICAgIGxldCByZXN1bHQ6IEV4cHJlc3Npb24gPSB7XG4gICAgICBsb3A6IHVuZGVmaW5lZCxcbiAgICAgIG9wOiB1bmRlZmluZWRcbiAgICB9O1xuICAgIE9iamVjdC5rZXlzKG9iaiB8fCB7fSkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICByZXN1bHQgPSBGaWx0ZXJFeHByZXNzaW9uVXRpbHMuc3RhY2tFeHByZXNzaW9uRXF1YWxzQU5EKGtleSwgb2JqW2tleV0sIHJlc3VsdCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIHN0YWNrRXhwcmVzc2lvbkxpa2VPUihrZXk6IHN0cmluZywgdmFsdWU6IGFueSwgZXhwcjogRXhwcmVzc2lvbik6IEV4cHJlc3Npb24ge1xuICAgIGNvbnN0IGxpa2VFeHByID0gRmlsdGVyRXhwcmVzc2lvblV0aWxzLmJ1aWxkRXhwcmVzc2lvbkxpa2Uoa2V5LCB2YWx1ZSk7XG4gICAgaWYgKGV4cHIubG9wID09PSB1bmRlZmluZWQgJiYgZXhwci5vcCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gbGlrZUV4cHI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGV4cHIgPSBGaWx0ZXJFeHByZXNzaW9uVXRpbHMuYnVpbGRDb21wbGV4RXhwcmVzc2lvbihleHByLCBsaWtlRXhwciwgRmlsdGVyRXhwcmVzc2lvblV0aWxzLk9QX09SKTtcbiAgICB9XG4gICAgcmV0dXJuIGV4cHI7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBzdGFja0V4cHJlc3Npb25FcXVhbHNBTkQoa2V5OiBzdHJpbmcsIHZhbHVlOiBhbnksIGV4cHI6IEV4cHJlc3Npb24pOiBFeHByZXNzaW9uIHtcbiAgICBjb25zdCBlcXVhbHNFeHByID0gRmlsdGVyRXhwcmVzc2lvblV0aWxzLmJ1aWxkRXhwcmVzc2lvbkVxdWFscyhrZXksIHZhbHVlKTtcbiAgICBpZiAoZXhwci5sb3AgPT09IHVuZGVmaW5lZCAmJiBleHByLm9wID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBlcXVhbHNFeHByO1xuICAgIH0gZWxzZSB7XG4gICAgICBleHByID0gRmlsdGVyRXhwcmVzc2lvblV0aWxzLmJ1aWxkQ29tcGxleEV4cHJlc3Npb24oZXhwciwgZXF1YWxzRXhwciwgRmlsdGVyRXhwcmVzc2lvblV0aWxzLk9QX0FORCk7XG4gICAgfVxuICAgIHJldHVybiBleHByO1xuICB9XG5cbn1cbiJdfQ==