import { Codes } from '../../../util/codes';
import { Util } from '../../../util/util';
var OTableStorage = (function () {
    function OTableStorage(table) {
        this.table = table;
    }
    OTableStorage.prototype.getDataToStore = function () {
        var dataToStore = {
            filter: this.table.oTableQuickFilterComponent ? this.table.oTableQuickFilterComponent.value : ''
        };
        var properties = ['sort', 'columns-display', 'columns-filter', 'quick-filter', 'page', 'selection', 'initial-configuration', 'filter-columns', 'filter-column-active-by-default'];
        Object.assign(dataToStore, this.getTablePropertiesToStore(properties));
        var storedFiltersArr = this.getStoredFilters();
        if (storedFiltersArr.length > 0) {
            dataToStore[OTableStorage.USER_STORED_FILTERS_KEY] = storedFiltersArr;
        }
        var storedConfigurationsArr = this.getStoredConfigurations();
        if (storedConfigurationsArr.length > 0) {
            dataToStore[OTableStorage.STORED_CONFIGURATIONS_KEY] = storedConfigurationsArr;
        }
        return dataToStore;
    };
    OTableStorage.prototype.getTablePropertiesToStore = function (properties) {
        var _this = this;
        var result = {};
        properties.forEach(function (prop) {
            Object.assign(result, _this.getTablePropertyToStore(prop));
        });
        return result;
    };
    OTableStorage.prototype.getTablePropertyToStore = function (property) {
        var result = {};
        switch (property) {
            case 'sort':
                result = this.getSortState();
                break;
            case 'columns-display':
                result = this.getColumnsDisplayState();
                break;
            case 'quick-filter':
                result = this.getColumnsQuickFilterState();
                break;
            case 'columns-filter':
                result = this.getColumnFiltersState();
                break;
            case 'page':
                result = this.getPageState();
                break;
            case 'selection':
                result = this.getSelectionState();
                break;
            case 'initial-configuration':
                result = this.getInitialConfigurationState();
                break;
            case 'filter-column-active-by-default':
                result = this.getFilterColumnActiveByDefaultState();
                break;
            case 'filter-columns':
                result = this.getFilterColumnsState();
                break;
        }
        return result;
    };
    OTableStorage.prototype.getFilterColumnsState = function () {
        var result = {};
        if (this.table.state.hasOwnProperty('filter-columns') && this.table.state['filter-columns']) {
            result['filter-columns'] = this.table.state['filter-columns'];
        }
        else if (this.table.filterColumns) {
            result['filter-columns'] = this.table.filterColumns;
        }
        return result;
    };
    OTableStorage.prototype.reset = function () {
        var state = {};
        state[OTableStorage.USER_STORED_FILTERS_KEY] = this.table.state[OTableStorage.USER_STORED_FILTERS_KEY];
        state[OTableStorage.STORED_CONFIGURATIONS_KEY] = this.table.state[OTableStorage.STORED_CONFIGURATIONS_KEY];
        if (this.table.pageable) {
            state.totalQueryRecordsNumber = this.table.state.totalQueryRecordsNumber;
        }
        state.currentPage = 0;
        this.table.state = state;
    };
    OTableStorage.prototype.getSortState = function () {
        var result = {};
        var sortColumnsArray = this.table.sort.getSortColumns();
        if (sortColumnsArray.length > 0) {
            var sortColumns_1 = [];
            sortColumnsArray.forEach(function (sortData) {
                sortColumns_1.push(sortData.id + Codes.COLUMNS_ALIAS_SEPARATOR + sortData.direction);
            });
            result['sort-columns'] = sortColumns_1.join(Codes.ARRAY_INPUT_SEPARATOR);
        }
        return result;
    };
    OTableStorage.prototype.getFilterColumnActiveByDefaultState = function () {
        var result = {};
        if (this.table.oTableColumnsFilterComponent) {
            result['filter-column-active-by-default'] = this.table.showFilterByColumnIcon;
        }
        return result;
    };
    OTableStorage.prototype.getColumnFiltersState = function () {
        var result = {};
        if (this.table.oTableColumnsFilterComponent) {
            var columnValueFilters = this.table.dataSource.getColumnValueFilters();
            if (columnValueFilters.length > 0) {
                result['column-value-filters'] = columnValueFilters;
            }
        }
        return result;
    };
    OTableStorage.prototype.getColumnsDisplayState = function () {
        var result = {};
        var oColumnsData = [];
        this.table.oTableOptions.columns.forEach(function (oCol) {
            oColumnsData.push({
                attr: oCol.attr,
                visible: oCol.visible,
                width: oCol.getWidthToStore()
            });
        });
        result['oColumns-display'] = oColumnsData;
        result['select-column-visible'] = this.table.oTableOptions.selectColumn.visible;
        return result;
    };
    OTableStorage.prototype.getColumnsQuickFilterState = function () {
        var result = {};
        var tableOptions = this.table.oTableOptions;
        var oColumnsData = [];
        tableOptions.columns.forEach(function (oCol) {
            oColumnsData.push({
                attr: oCol.attr,
                searchable: oCol.searchable,
                searching: oCol.searching
            });
        });
        result.oColumns = oColumnsData;
        result['filter-case-sensitive'] = tableOptions.filterCaseSensitive;
        return result;
    };
    OTableStorage.prototype.getPageState = function () {
        var result = {
            'query-rows': this.table.matpaginator ? this.table.matpaginator.pageSize : ''
        };
        if (this.table.currentPage > 0 && this.table.storePaginationState) {
            result.currentPage = this.table.currentPage;
        }
        if (this.table.pageable && this.table.storePaginationState) {
            var state = this.table.state;
            result.totalQueryRecordsNumber = state.totalQueryRecordsNumber;
            result.queryRecordOffset = Math.max((state.queryRecordOffset - this.table.dataSource.renderedData.length), (state.queryRecordOffset - this.table.queryRows));
        }
        return result;
    };
    OTableStorage.prototype.getSelectionState = function () {
        var _this = this;
        var result = {
            selection: []
        };
        if (this.table && this.table.keepSelectedItems) {
            var selection_1 = [];
            this.table.getSelectedItems().forEach(function (item) {
                var data = {};
                _this.table.getKeys().forEach(function (key) {
                    data[key] = item[key];
                });
                selection_1.push(data);
            });
            result.selection = selection_1;
        }
        return result;
    };
    OTableStorage.prototype.getInitialConfigurationState = function () {
        var result = {};
        var initialConfiguration = {};
        var oColumnsData = [];
        var self = this;
        Util.parseArray(this.table.visibleColumns, true).forEach(function (x) {
            var oCol = self.table.getOColumn(x);
            oColumnsData.push({
                attr: oCol.attr,
                visible: true,
                width: oCol.definition ? oCol.definition.originalWidth : undefined
            });
        });
        initialConfiguration['oColumns-display'] = oColumnsData;
        initialConfiguration['sort-columns'] = this.table.sortColumns;
        initialConfiguration['select-column-visible'] = this.table.oTableOptions.selectColumn.visible;
        initialConfiguration['filter-case-sensitive'] = this.table.filterCaseSensitive;
        initialConfiguration['query-rows'] = this.table.originalQueryRows;
        initialConfiguration['filter-column-active-by-default'] = this.table.originalFilterColumnActiveByDefault;
        initialConfiguration['filter-columns'] = this.table.originalFilterColumns;
        result['initial-configuration'] = initialConfiguration;
        return result;
    };
    OTableStorage.prototype.setStoredFilters = function (filters) {
        return this.table.state[OTableStorage.USER_STORED_FILTERS_KEY] = filters;
    };
    OTableStorage.prototype.getStoredFilters = function () {
        return this.table.state[OTableStorage.USER_STORED_FILTERS_KEY] || [];
    };
    OTableStorage.prototype.getStoredFilter = function (filterName) {
        return this.getStoredFilters().find(function (item) { return item.name === filterName; });
    };
    OTableStorage.prototype.getStoredFilterConf = function (filterName) {
        return (this.getStoredFilter(filterName) || {})[OTableStorage.STORED_FILTER_KEY];
    };
    OTableStorage.prototype.deleteStoredFilter = function (filterName) {
        var storedFilters = this.table.state[OTableStorage.USER_STORED_FILTERS_KEY] || [];
        var index = storedFilters.findIndex(function (item) { return item.name === filterName; });
        if (index >= 0) {
            storedFilters.splice(index, 1);
            this.table.state[OTableStorage.USER_STORED_FILTERS_KEY] = storedFilters;
        }
    };
    OTableStorage.prototype.storeFilter = function (filterArgs) {
        var result = {};
        var storedFilter = {};
        Object.assign(storedFilter, this.getColumnFiltersState());
        Object.assign(storedFilter, this.getColumnsQuickFilterState());
        result[OTableStorage.STORED_FILTER_KEY] = storedFilter;
        Object.assign(result, filterArgs);
        var existingFilters = this.getStoredFilters();
        existingFilters.push(result);
        this.table.state[OTableStorage.USER_STORED_FILTERS_KEY] = existingFilters;
    };
    OTableStorage.prototype.getStoredColumnsFilters = function (arg) {
        var stateObj = arg || this.table.state;
        return stateObj['column-value-filters'] || [];
    };
    OTableStorage.prototype.getStoredFiltersColumns = function (arg) {
        var stateObj = arg || this.table.state;
        return stateObj['filter-columns'] || [];
    };
    OTableStorage.prototype.getStoredConfigurations = function () {
        return this.table.state[OTableStorage.STORED_CONFIGURATIONS_KEY] || [];
    };
    OTableStorage.prototype.getStoredConfiguration = function (configurationName) {
        return this.getStoredConfigurations().find(function (item) { return item.name === configurationName; });
    };
    OTableStorage.prototype.storeConfiguration = function (configurationAgs, tableProperties) {
        var result = {};
        this.table.storePaginationState = true;
        var storedConfiguration = this.getTablePropertiesToStore(tableProperties);
        this.table.storePaginationState = false;
        result[OTableStorage.STORED_CONFIGURATION_KEY] = storedConfiguration;
        Object.assign(result, configurationAgs);
        result[OTableStorage.STORED_PROPERTIES_KEY] = tableProperties;
        var existingConfigurations = this.getStoredConfigurations();
        existingConfigurations.push(result);
        this.table.state[OTableStorage.STORED_CONFIGURATIONS_KEY] = existingConfigurations;
    };
    OTableStorage.prototype.deleteStoredConfiguration = function (configurationName) {
        var storedConfigurations = this.getStoredConfigurations();
        var index = storedConfigurations.findIndex(function (item) { return item.name === configurationName; });
        if (index >= 0) {
            storedConfigurations.splice(index, 1);
            this.table.state[OTableStorage.STORED_CONFIGURATIONS_KEY] = storedConfigurations;
        }
    };
    OTableStorage.STORED_FILTER_KEY = 'stored-filter';
    OTableStorage.USER_STORED_FILTERS_KEY = 'user-stored-filters';
    OTableStorage.STORED_CONFIGURATION_KEY = 'stored-configuration';
    OTableStorage.STORED_PROPERTIES_KEY = 'stored-properties';
    OTableStorage.STORED_CONFIGURATIONS_KEY = 'user-stored-configurations';
    return OTableStorage;
}());
export { OTableStorage };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby10YWJsZS1zdG9yYWdlLmNsYXNzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RhYmxlL2V4dGVuc2lvbnMvby10YWJsZS1zdG9yYWdlLmNsYXNzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1QyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFJMUM7SUFTRSx1QkFDWSxLQUFzQjtRQUF0QixVQUFLLEdBQUwsS0FBSyxDQUFpQjtJQUM5QixDQUFDO0lBRUwsc0NBQWMsR0FBZDtRQUNFLElBQU0sV0FBVyxHQUFHO1lBQ2xCLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLDBCQUEwQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRTtTQUNqRyxDQUFDO1FBRUYsSUFBTSxVQUFVLEdBQUcsQ0FBQyxNQUFNLEVBQUUsaUJBQWlCLEVBQUUsZ0JBQWdCLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsdUJBQXVCLEVBQUUsZ0JBQWdCLEVBQUUsaUNBQWlDLENBQUMsQ0FBQztRQUVwTCxNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMseUJBQXlCLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUV2RSxJQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ2pELElBQUksZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUMvQixXQUFXLENBQUMsYUFBYSxDQUFDLHVCQUF1QixDQUFDLEdBQUcsZ0JBQWdCLENBQUM7U0FDdkU7UUFDRCxJQUFNLHVCQUF1QixHQUFHLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDO1FB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QUMseUJBQXlCLENBQUMsR0FBRyxvQkFBb0IsQ0FBQztTQUNsRjtJQUNILENBQUM7SUE5U2EsK0JBQWlCLEdBQUcsZUFBZSxDQUFDO0lBQ3BDLHFDQUF1QixHQUFHLHFCQUFxQixDQUFDO0lBRWhELHNDQUF3QixHQUFHLHNCQUFzQixDQUFDO0lBQ2xELG1DQUFxQixHQUFHLG1CQUFtQixDQUFDO0lBQzVDLHVDQUF5QixHQUFHLDRCQUE0QixDQUFDO0lBMlN6RSxvQkFBQztDQUFBLEFBbFRELElBa1RDO1NBbFRZLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPVGFibGVDb25maWd1cmF0aW9uIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvby10YWJsZS1jb25maWd1cmF0aW9uLnR5cGUnO1xuaW1wb3J0IHsgT1RhYmxlRmlsdGVyc1N0YXR1cyB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL28tdGFibGUtZmlsdGVyLXN0YXR1cy50eXBlJztcbmltcG9ydCB7IENvZGVzIH0gZnJvbSAnLi4vLi4vLi4vdXRpbC9jb2Rlcyc7XG5pbXBvcnQgeyBVdGlsIH0gZnJvbSAnLi4vLi4vLi4vdXRpbC91dGlsJztcbmltcG9ydCB7IE9Db2x1bW4gfSBmcm9tICcuLi9jb2x1bW4vby1jb2x1bW4uY2xhc3MnO1xuaW1wb3J0IHsgT1RhYmxlQ29tcG9uZW50IH0gZnJvbSAnLi4vby10YWJsZS5jb21wb25lbnQnO1xuXG5leHBvcnQgY2xhc3MgT1RhYmxlU3RvcmFnZSB7XG5cbiAgcHVibGljIHN0YXRpYyBTVE9SRURfRklMVEVSX0tFWSA9ICdzdG9yZWQtZmlsdGVyJztcbiAgcHVibGljIHN0YXRpYyBVU0VSX1NUT1JFRF9GSUxURVJTX0tFWSA9ICd1c2VyLXN0b3JlZC1maWx0ZXJzJztcblxuICBwdWJsaWMgc3RhdGljIFNUT1JFRF9DT05GSUdVUkFUSU9OX0tFWSA9ICdzdG9yZWQtY29uZmlndXJhdGlvbic7XG4gIHB1YmxpYyBzdGF0aWMgU1RPUkVEX1BST1BFUlRJRVNfS0VZID0gJ3N0b3JlZC1wcm9wZXJ0aWVzJztcbiAgcHVibGljIHN0YXRpYyBTVE9SRURfQ09ORklHVVJBVElPTlNfS0VZID0gJ3VzZXItc3RvcmVkLWNvbmZpZ3VyYXRpb25zJztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgdGFibGU6IE9UYWJsZUNvbXBvbmVudFxuICApIHsgfVxuXG4gIGdldERhdGFUb1N0b3JlKCkge1xuICAgIGNvbnN0IGRhdGFUb1N0b3JlID0ge1xuICAgICAgZmlsdGVyOiB0aGlzLnRhYmxlLm9UYWJsZVF1aWNrRmlsdGVyQ29tcG9uZW50ID8gdGhpcy50YWJsZS5vVGFibGVRdWlja0ZpbHRlckNvbXBvbmVudC52YWx1ZSA6ICcnXG4gICAgfTtcblxuICAgIGNvbnN0IHByb3BlcnRpZXMgPSBbJ3NvcnQnLCAnY29sdW1ucy1kaXNwbGF5JywgJ2NvbHVtbnMtZmlsdGVyJywgJ3F1aWNrLWZpbHRlcicsICdwYWdlJywgJ3NlbGVjdGlvbicsICdpbml0aWFsLWNvbmZpZ3VyYXRpb24nLCAnZmlsdGVyLWNvbHVtbnMnLCAnZmlsdGVyLWNvbHVtbi1hY3RpdmUtYnktZGVmYXVsdCddO1xuICAgIFxuICAgIE9iamVjdC5hc3NpZ24oZGF0YVRvU3RvcmUsIHRoaXMuZ2V0VGFibGVQcm9wZXJ0aWVzVG9TdG9yZShwcm9wZXJ0aWVzKSk7XG5cbiAgICBjb25zdCBzdG9yZWRGaWx0ZXJzQXJyID0gdGhpcy5nZXRTdG9yZWRGaWx0ZXJzKCk7XG4gICAgaWYgKHN0b3JlZEZpbHRlcnNBcnIubGVuZ3RoID4gMCkge1xuICAgICAgZGF0YVRvU3RvcmVbT1RhYmxlU3RvcmFnZS5VU0VSX1NUT1JFRF9GSUxURVJTX0tFWV0gPSBzdG9yZWRGaWx0ZXJzQXJyO1xuICAgIH1cbiAgICBjb25zdCBzdG9yZWRDb25maWd1cmF0aW9uc0FyciA9IHRoaXMuZ2V0U3RvcmVkQ29uZmlndXJhdGlvbnMoKTtcbiAgICBpZiAoc3RvcmVkQ29uZmlndXJhdGlvbnNBcnIubGVuZ3RoID4gMCkge1xuICAgICAgZGF0YVRvU3RvcmVbT1RhYmxlU3RvcmFnZS5TVE9SRURfQ09ORklHVVJBVElPTlNfS0VZXSA9IHN0b3JlZENvbmZpZ3VyYXRpb25zQXJyO1xuICAgIH1cblxuICAgIHJldHVybiBkYXRhVG9TdG9yZTtcbiAgfVxuXG4gIGdldFRhYmxlUHJvcGVydGllc1RvU3RvcmUocHJvcGVydGllczogc3RyaW5nW10pIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2gocHJvcCA9PiB7XG4gICAgICBPYmplY3QuYXNzaWduKHJlc3VsdCwgdGhpcy5nZXRUYWJsZVByb3BlcnR5VG9TdG9yZShwcm9wKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGdldFRhYmxlUHJvcGVydHlUb1N0b3JlKHByb3BlcnR5OiBzdHJpbmcpIHtcbiAgICBsZXQgcmVzdWx0ID0ge307XG4gICAgc3dpdGNoIChwcm9wZXJ0eSkge1xuICAgICAgY2FzZSAnc29ydCc6XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuZ2V0U29ydFN0YXRlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnY29sdW1ucy1kaXNwbGF5JzpcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5nZXRDb2x1bW5zRGlzcGxheVN0YXRlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncXVpY2stZmlsdGVyJzpcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5nZXRDb2x1bW5zUXVpY2tGaWx0ZXJTdGF0ZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2NvbHVtbnMtZmlsdGVyJzpcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5nZXRDb2x1bW5GaWx0ZXJzU3RhdGUoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdwYWdlJzpcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5nZXRQYWdlU3RhdGUoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzZWxlY3Rpb24nOlxuICAgICAgICByZXN1bHQgPSB0aGlzLmdldFNlbGVjdGlvblN0YXRlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnaW5pdGlhbC1jb25maWd1cmF0aW9uJzpcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5nZXRJbml0aWFsQ29uZmlndXJhdGlvblN0YXRlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZmlsdGVyLWNvbHVtbi1hY3RpdmUtYnktZGVmYXVsdCc6XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuZ2V0RmlsdGVyQ29sdW1uQWN0aXZlQnlEZWZhdWx0U3RhdGUoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdmaWx0ZXItY29sdW1ucyc6XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuZ2V0RmlsdGVyQ29sdW1uc1N0YXRlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgZ2V0RmlsdGVyQ29sdW1uc1N0YXRlKCk6IGFueSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgaWYgKHRoaXMudGFibGUuc3RhdGUuaGFzT3duUHJvcGVydHkoJ2ZpbHRlci1jb2x1bW5zJykgJiYgdGhpcy50YWJsZS5zdGF0ZVsnZmlsdGVyLWNvbHVtbnMnXSkge1xuICAgICAgcmVzdWx0WydmaWx0ZXItY29sdW1ucyddID0gdGhpcy50YWJsZS5zdGF0ZVsnZmlsdGVyLWNvbHVtbnMnXTtcbiAgICB9IGVsc2UgaWYgKHRoaXMudGFibGUuZmlsdGVyQ29sdW1ucykge1xuICAgICAgcmVzdWx0WydmaWx0ZXItY29sdW1ucyddID0gdGhpcy50YWJsZS5maWx0ZXJDb2x1bW5zO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICByZXNldCgpIHtcbiAgICBjb25zdCBzdGF0ZTogYW55ID0ge307XG4gICAgc3RhdGVbT1RhYmxlU3RvcmFnZS5VU0VSX1NUT1JFRF9GSUxURVJTX0tFWV0gPSB0aGlzLnRhYmxlLnN0YXRlW09UYWJsZVN0b3JhZ2UuVVNFUl9TVE9SRURfRklMVEVSU19LRVldO1xuICAgIHN0YXRlW09UYWJsZVN0b3JhZ2UuU1RPUkVEX0NPTkZJR1VSQVRJT05TX0tFWV0gPSB0aGlzLnRhYmxlLnN0YXRlW09UYWJsZVN0b3JhZ2UuU1RPUkVEX0NPTkZJR1VSQVRJT05TX0tFWV07XG4gICAgaWYgKHRoaXMudGFibGUucGFnZWFibGUpIHtcbiAgICAgIHN0YXRlLnRvdGFsUXVlcnlSZWNvcmRzTnVtYmVyID0gdGhpcy50YWJsZS5zdGF0ZS50b3RhbFF1ZXJ5UmVjb3Jkc051bWJlcjtcbiAgICB9XG4gICAgc3RhdGUuY3VycmVudFBhZ2UgPSAwO1xuICAgIHRoaXMudGFibGUuc3RhdGUgPSBzdGF0ZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRTb3J0U3RhdGUoKSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgY29uc3Qgc29ydENvbHVtbnNBcnJheSA9IHRoaXMudGFibGUuc29ydC5nZXRTb3J0Q29sdW1ucygpO1xuICAgIGlmIChzb3J0Q29sdW1uc0FycmF5Lmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHNvcnRDb2x1bW5zID0gW107XG4gICAgICBzb3J0Q29sdW1uc0FycmF5LmZvckVhY2goc29ydERhdGEgPT4ge1xuICAgICAgICBzb3J0Q29sdW1ucy5wdXNoKHNvcnREYXRhLmlkICsgQ29kZXMuQ09MVU1OU19BTElBU19TRVBBUkFUT1IgKyBzb3J0RGF0YS5kaXJlY3Rpb24pO1xuICAgICAgfSk7XG4gICAgICByZXN1bHRbJ3NvcnQtY29sdW1ucyddID0gc29ydENvbHVtbnMuam9pbihDb2Rlcy5BUlJBWV9JTlBVVF9TRVBBUkFUT1IpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldEZpbHRlckNvbHVtbkFjdGl2ZUJ5RGVmYXVsdFN0YXRlKCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgIGlmICh0aGlzLnRhYmxlLm9UYWJsZUNvbHVtbnNGaWx0ZXJDb21wb25lbnQpIHtcbiAgICAgIHJlc3VsdFsnZmlsdGVyLWNvbHVtbi1hY3RpdmUtYnktZGVmYXVsdCddID0gdGhpcy50YWJsZS5zaG93RmlsdGVyQnlDb2x1bW5JY29uO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldENvbHVtbkZpbHRlcnNTdGF0ZSgpIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBpZiAodGhpcy50YWJsZS5vVGFibGVDb2x1bW5zRmlsdGVyQ29tcG9uZW50KSB7XG4gICAgICBjb25zdCBjb2x1bW5WYWx1ZUZpbHRlcnMgPSB0aGlzLnRhYmxlLmRhdGFTb3VyY2UuZ2V0Q29sdW1uVmFsdWVGaWx0ZXJzKCk7XG4gICAgICBpZiAoY29sdW1uVmFsdWVGaWx0ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmVzdWx0Wydjb2x1bW4tdmFsdWUtZmlsdGVycyddID0gY29sdW1uVmFsdWVGaWx0ZXJzO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cblxuICBwcm90ZWN0ZWQgZ2V0Q29sdW1uc0Rpc3BsYXlTdGF0ZSgpIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBjb25zdCBvQ29sdW1uc0RhdGEgPSBbXTtcbiAgICB0aGlzLnRhYmxlLm9UYWJsZU9wdGlvbnMuY29sdW1ucy5mb3JFYWNoKChvQ29sOiBPQ29sdW1uKSA9PiB7XG4gICAgICBvQ29sdW1uc0RhdGEucHVzaCh7XG4gICAgICAgIGF0dHI6IG9Db2wuYXR0cixcbiAgICAgICAgdmlzaWJsZTogb0NvbC52aXNpYmxlLFxuICAgICAgICB3aWR0aDogb0NvbC5nZXRXaWR0aFRvU3RvcmUoKVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmVzdWx0WydvQ29sdW1ucy1kaXNwbGF5J10gPSBvQ29sdW1uc0RhdGE7XG4gICAgcmVzdWx0WydzZWxlY3QtY29sdW1uLXZpc2libGUnXSA9IHRoaXMudGFibGUub1RhYmxlT3B0aW9ucy5zZWxlY3RDb2x1bW4udmlzaWJsZTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldENvbHVtbnNRdWlja0ZpbHRlclN0YXRlKCkge1xuICAgIGNvbnN0IHJlc3VsdDogYW55ID0ge307XG4gICAgY29uc3QgdGFibGVPcHRpb25zID0gdGhpcy50YWJsZS5vVGFibGVPcHRpb25zO1xuICAgIGNvbnN0IG9Db2x1bW5zRGF0YSA9IFtdO1xuICAgIHRhYmxlT3B0aW9ucy5jb2x1bW5zLmZvckVhY2goKG9Db2w6IE9Db2x1bW4pID0+IHtcbiAgICAgIG9Db2x1bW5zRGF0YS5wdXNoKHtcbiAgICAgICAgYXR0cjogb0NvbC5hdHRyLFxuICAgICAgICBzZWFyY2hhYmxlOiBvQ29sLnNlYXJjaGFibGUsXG4gICAgICAgIHNlYXJjaGluZzogb0NvbC5zZWFyY2hpbmdcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJlc3VsdC5vQ29sdW1ucyA9IG9Db2x1bW5zRGF0YTtcbiAgICByZXN1bHRbJ2ZpbHRlci1jYXNlLXNlbnNpdGl2ZSddID0gdGFibGVPcHRpb25zLmZpbHRlckNhc2VTZW5zaXRpdmU7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRQYWdlU3RhdGUoKTogYW55IHtcbiAgICBjb25zdCByZXN1bHQ6IGFueSA9IHtcbiAgICAgICdxdWVyeS1yb3dzJzogdGhpcy50YWJsZS5tYXRwYWdpbmF0b3IgPyB0aGlzLnRhYmxlLm1hdHBhZ2luYXRvci5wYWdlU2l6ZSA6ICcnXG4gICAgfTtcbiAgICBpZiAodGhpcy50YWJsZS5jdXJyZW50UGFnZSA+IDAgJiYgdGhpcy50YWJsZS5zdG9yZVBhZ2luYXRpb25TdGF0ZSkge1xuICAgICAgcmVzdWx0LmN1cnJlbnRQYWdlID0gdGhpcy50YWJsZS5jdXJyZW50UGFnZTtcbiAgICB9XG4gICAgaWYgKHRoaXMudGFibGUucGFnZWFibGUgJiYgdGhpcy50YWJsZS5zdG9yZVBhZ2luYXRpb25TdGF0ZSkge1xuICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLnRhYmxlLnN0YXRlO1xuICAgICAgcmVzdWx0LnRvdGFsUXVlcnlSZWNvcmRzTnVtYmVyID0gc3RhdGUudG90YWxRdWVyeVJlY29yZHNOdW1iZXI7XG4gICAgICByZXN1bHQucXVlcnlSZWNvcmRPZmZzZXQgPSBNYXRoLm1heChcbiAgICAgICAgKHN0YXRlLnF1ZXJ5UmVjb3JkT2Zmc2V0IC0gdGhpcy50YWJsZS5kYXRhU291cmNlLnJlbmRlcmVkRGF0YS5sZW5ndGgpLFxuICAgICAgICAoc3RhdGUucXVlcnlSZWNvcmRPZmZzZXQgLSB0aGlzLnRhYmxlLnF1ZXJ5Um93cylcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0U2VsZWN0aW9uU3RhdGUoKTogYW55IHtcbiAgICBjb25zdCByZXN1bHQ6IGFueSA9IHtcbiAgICAgIHNlbGVjdGlvbjogW11cbiAgICB9O1xuICAgIGlmICh0aGlzLnRhYmxlICYmIHRoaXMudGFibGUua2VlcFNlbGVjdGVkSXRlbXMpIHtcbiAgICAgIC8vIHN0b3Jpbmcgc2VsZWN0ZWQgaXRlbXMga2V5cyB2YWx1ZXNcbiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IFtdO1xuICAgICAgdGhpcy50YWJsZS5nZXRTZWxlY3RlZEl0ZW1zKCkuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHt9O1xuICAgICAgICB0aGlzLnRhYmxlLmdldEtleXMoKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgZGF0YVtrZXldID0gaXRlbVtrZXldO1xuICAgICAgICB9KTtcbiAgICAgICAgc2VsZWN0aW9uLnB1c2goZGF0YSk7XG4gICAgICB9KTtcbiAgICAgIHJlc3VsdC5zZWxlY3Rpb24gPSBzZWxlY3Rpb247XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0SW5pdGlhbENvbmZpZ3VyYXRpb25TdGF0ZSgpOiBhbnkge1xuICAgIGxldCByZXN1bHQgPSB7fTtcbiAgICBsZXQgaW5pdGlhbENvbmZpZ3VyYXRpb24gPSB7fTtcblxuICAgIGxldCBvQ29sdW1uc0RhdGEgPSBbXTtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBVdGlsLnBhcnNlQXJyYXkodGhpcy50YWJsZS52aXNpYmxlQ29sdW1ucywgdHJ1ZSkuZm9yRWFjaCgoeDogc3RyaW5nKSA9PiB7XG4gICAgICBsZXQgb0NvbCA9IHNlbGYudGFibGUuZ2V0T0NvbHVtbih4KTtcbiAgICAgIG9Db2x1bW5zRGF0YS5wdXNoKHtcbiAgICAgICAgYXR0cjogb0NvbC5hdHRyLFxuICAgICAgICB2aXNpYmxlOiB0cnVlLFxuICAgICAgICB3aWR0aDogb0NvbC5kZWZpbml0aW9uID8gb0NvbC5kZWZpbml0aW9uLm9yaWdpbmFsV2lkdGggOiB1bmRlZmluZWRcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaW5pdGlhbENvbmZpZ3VyYXRpb25bJ29Db2x1bW5zLWRpc3BsYXknXSA9IG9Db2x1bW5zRGF0YTtcbiAgICBpbml0aWFsQ29uZmlndXJhdGlvblsnc29ydC1jb2x1bW5zJ10gPSB0aGlzLnRhYmxlLnNvcnRDb2x1bW5zO1xuICAgIGluaXRpYWxDb25maWd1cmF0aW9uWydzZWxlY3QtY29sdW1uLXZpc2libGUnXSA9IHRoaXMudGFibGUub1RhYmxlT3B0aW9ucy5zZWxlY3RDb2x1bW4udmlzaWJsZTtcbiAgICBpbml0aWFsQ29uZmlndXJhdGlvblsnZmlsdGVyLWNhc2Utc2Vuc2l0aXZlJ10gPSB0aGlzLnRhYmxlLmZpbHRlckNhc2VTZW5zaXRpdmU7XG4gICAgaW5pdGlhbENvbmZpZ3VyYXRpb25bJ3F1ZXJ5LXJvd3MnXSA9IHRoaXMudGFibGUub3JpZ2luYWxRdWVyeVJvd3M7XG4gICAgaW5pdGlhbENvbmZpZ3VyYXRpb25bJ2ZpbHRlci1jb2x1bW4tYWN0aXZlLWJ5LWRlZmF1bHQnXSA9IHRoaXMudGFibGUub3JpZ2luYWxGaWx0ZXJDb2x1bW5BY3RpdmVCeURlZmF1bHQ7XG4gICAgaW5pdGlhbENvbmZpZ3VyYXRpb25bJ2ZpbHRlci1jb2x1bW5zJ10gPSB0aGlzLnRhYmxlLm9yaWdpbmFsRmlsdGVyQ29sdW1ucztcblxuICAgIHJlc3VsdFsnaW5pdGlhbC1jb25maWd1cmF0aW9uJ10gPSBpbml0aWFsQ29uZmlndXJhdGlvbjtcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBzZXRTdG9yZWRGaWx0ZXJzKGZpbHRlcnM6IEFycmF5PE9UYWJsZUZpbHRlcnNTdGF0dXM+KSB7XG4gICAgcmV0dXJuIHRoaXMudGFibGUuc3RhdGVbT1RhYmxlU3RvcmFnZS5VU0VSX1NUT1JFRF9GSUxURVJTX0tFWV0gPSBmaWx0ZXJzO1xuICB9XG5cbiAgZ2V0U3RvcmVkRmlsdGVycygpIHtcbiAgICByZXR1cm4gdGhpcy50YWJsZS5zdGF0ZVtPVGFibGVTdG9yYWdlLlVTRVJfU1RPUkVEX0ZJTFRFUlNfS0VZXSB8fCBbXTtcbiAgfVxuXG4gIGdldFN0b3JlZEZpbHRlcihmaWx0ZXJOYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdG9yZWRGaWx0ZXJzKCkuZmluZCgoaXRlbTogT1RhYmxlRmlsdGVyc1N0YXR1cykgPT4gaXRlbS5uYW1lID09PSBmaWx0ZXJOYW1lKTtcbiAgfVxuXG4gIGdldFN0b3JlZEZpbHRlckNvbmYoZmlsdGVyTmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuICh0aGlzLmdldFN0b3JlZEZpbHRlcihmaWx0ZXJOYW1lKSB8fCB7fSlbT1RhYmxlU3RvcmFnZS5TVE9SRURfRklMVEVSX0tFWV07XG4gIH1cblxuICBkZWxldGVTdG9yZWRGaWx0ZXIoZmlsdGVyTmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3Qgc3RvcmVkRmlsdGVycyA9IHRoaXMudGFibGUuc3RhdGVbT1RhYmxlU3RvcmFnZS5VU0VSX1NUT1JFRF9GSUxURVJTX0tFWV0gfHwgW107XG4gICAgY29uc3QgaW5kZXggPSBzdG9yZWRGaWx0ZXJzLmZpbmRJbmRleCgoaXRlbTogT1RhYmxlRmlsdGVyc1N0YXR1cykgPT4gaXRlbS5uYW1lID09PSBmaWx0ZXJOYW1lKTtcbiAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgc3RvcmVkRmlsdGVycy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgdGhpcy50YWJsZS5zdGF0ZVtPVGFibGVTdG9yYWdlLlVTRVJfU1RPUkVEX0ZJTFRFUlNfS0VZXSA9IHN0b3JlZEZpbHRlcnM7XG4gICAgfVxuICB9XG5cbiAgc3RvcmVGaWx0ZXIoZmlsdGVyQXJnczogT1RhYmxlRmlsdGVyc1N0YXR1cykge1xuICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgIGNvbnN0IHN0b3JlZEZpbHRlciA9IHt9O1xuICAgIE9iamVjdC5hc3NpZ24oc3RvcmVkRmlsdGVyLCB0aGlzLmdldENvbHVtbkZpbHRlcnNTdGF0ZSgpKTtcbiAgICBPYmplY3QuYXNzaWduKHN0b3JlZEZpbHRlciwgdGhpcy5nZXRDb2x1bW5zUXVpY2tGaWx0ZXJTdGF0ZSgpKTtcblxuICAgIHJlc3VsdFtPVGFibGVTdG9yYWdlLlNUT1JFRF9GSUxURVJfS0VZXSA9IHN0b3JlZEZpbHRlcjtcbiAgICBPYmplY3QuYXNzaWduKHJlc3VsdCwgZmlsdGVyQXJncyk7XG4gICAgY29uc3QgZXhpc3RpbmdGaWx0ZXJzID0gdGhpcy5nZXRTdG9yZWRGaWx0ZXJzKCk7XG4gICAgZXhpc3RpbmdGaWx0ZXJzLnB1c2gocmVzdWx0KTtcbiAgICB0aGlzLnRhYmxlLnN0YXRlW09UYWJsZVN0b3JhZ2UuVVNFUl9TVE9SRURfRklMVEVSU19LRVldID0gZXhpc3RpbmdGaWx0ZXJzO1xuICB9XG5cbiAgZ2V0U3RvcmVkQ29sdW1uc0ZpbHRlcnMoYXJnPzogYW55KSB7XG4gICAgY29uc3Qgc3RhdGVPYmogPSBhcmcgfHwgdGhpcy50YWJsZS5zdGF0ZTtcbiAgICByZXR1cm4gc3RhdGVPYmpbJ2NvbHVtbi12YWx1ZS1maWx0ZXJzJ10gfHwgW107XG4gIH1cblxuICBnZXRTdG9yZWRGaWx0ZXJzQ29sdW1ucyhhcmc/OiBhbnkpIHtcbiAgICBjb25zdCBzdGF0ZU9iaiA9IGFyZyB8fCB0aGlzLnRhYmxlLnN0YXRlO1xuICAgIHJldHVybiBzdGF0ZU9ialsnZmlsdGVyLWNvbHVtbnMnXSB8fCBbXTtcbiAgfVxuXG4gIGdldFN0b3JlZENvbmZpZ3VyYXRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLnRhYmxlLnN0YXRlW09UYWJsZVN0b3JhZ2UuU1RPUkVEX0NPTkZJR1VSQVRJT05TX0tFWV0gfHwgW107XG4gIH1cblxuICBnZXRTdG9yZWRDb25maWd1cmF0aW9uKGNvbmZpZ3VyYXRpb25OYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdG9yZWRDb25maWd1cmF0aW9ucygpLmZpbmQoKGl0ZW06IE9UYWJsZUNvbmZpZ3VyYXRpb24pID0+IGl0ZW0ubmFtZSA9PT0gY29uZmlndXJhdGlvbk5hbWUpO1xuICB9XG5cbiAgc3RvcmVDb25maWd1cmF0aW9uKGNvbmZpZ3VyYXRpb25BZ3M6IE9UYWJsZUNvbmZpZ3VyYXRpb24sIHRhYmxlUHJvcGVydGllczogYW55W10pIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICB0aGlzLnRhYmxlLnN0b3JlUGFnaW5hdGlvblN0YXRlID0gdHJ1ZTtcbiAgICBjb25zdCBzdG9yZWRDb25maWd1cmF0aW9uID0gdGhpcy5nZXRUYWJsZVByb3BlcnRpZXNUb1N0b3JlKHRhYmxlUHJvcGVydGllcyk7XG4gICAgdGhpcy50YWJsZS5zdG9yZVBhZ2luYXRpb25TdGF0ZSA9IGZhbHNlO1xuXG4gICAgcmVzdWx0W09UYWJsZVN0b3JhZ2UuU1RPUkVEX0NPTkZJR1VSQVRJT05fS0VZXSA9IHN0b3JlZENvbmZpZ3VyYXRpb247XG4gICAgT2JqZWN0LmFzc2lnbihyZXN1bHQsIGNvbmZpZ3VyYXRpb25BZ3MpO1xuICAgIHJlc3VsdFtPVGFibGVTdG9yYWdlLlNUT1JFRF9QUk9QRVJUSUVTX0tFWV0gPSB0YWJsZVByb3BlcnRpZXM7XG4gICAgY29uc3QgZXhpc3RpbmdDb25maWd1cmF0aW9ucyA9IHRoaXMuZ2V0U3RvcmVkQ29uZmlndXJhdGlvbnMoKTtcbiAgICBleGlzdGluZ0NvbmZpZ3VyYXRpb25zLnB1c2gocmVzdWx0KTtcbiAgICB0aGlzLnRhYmxlLnN0YXRlW09UYWJsZVN0b3JhZ2UuU1RPUkVEX0NPTkZJR1VSQVRJT05TX0tFWV0gPSBleGlzdGluZ0NvbmZpZ3VyYXRpb25zO1xuICB9XG5cbiAgZGVsZXRlU3RvcmVkQ29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uTmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3Qgc3RvcmVkQ29uZmlndXJhdGlvbnMgPSB0aGlzLmdldFN0b3JlZENvbmZpZ3VyYXRpb25zKCk7XG4gICAgY29uc3QgaW5kZXggPSBzdG9yZWRDb25maWd1cmF0aW9ucy5maW5kSW5kZXgoKGl0ZW06IE9UYWJsZUNvbmZpZ3VyYXRpb24pID0+IGl0ZW0ubmFtZSA9PT0gY29uZmlndXJhdGlvbk5hbWUpO1xuICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICBzdG9yZWRDb25maWd1cmF0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgdGhpcy50YWJsZS5zdGF0ZVtPVGFibGVTdG9yYWdlLlNUT1JFRF9DT05GSUdVUkFUSU9OU19LRVldID0gc3RvcmVkQ29uZmlndXJhdGlvbnM7XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==