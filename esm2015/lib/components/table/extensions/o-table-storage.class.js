import { Codes } from '../../../util/codes';
import { Util } from '../../../util/util';
export class OTableStorage {
    constructor(table) {
        this.table = table;
    }
    getDataToStore() {
        const dataToStore = {
            filter: this.table.oTableQuickFilterComponent ? this.table.oTableQuickFilterComponent.value : ''
        };
        const properties = ['sort', 'columns-display', 'columns-filter', 'quick-filter', 'page', 'selection', 'initial-configuration', 'filter-columns', 'filter-column-active-by-default'];
        Object.assign(dataToStore, this.getTablePropertiesToStore(properties));
        const storedFiltersArr = this.getStoredFilters();
        if (storedFiltersArr.length > 0) {
            dataToStore[OTableStorage.USER_STORED_FILTERS_KEY] = storedFiltersArr;
        }
        const storedConfigurationsArr = this.getStoredConfigurations();
        if (storedConfigurationsArr.length > 0) {
            dataToStore[OTableStorage.STORED_CONFIGURATIONS_KEY] = storedConfigurationsArr;
        }
        return dataToStore;
    }
    getTablePropertiesToStore(properties) {
        const result = {};
        properties.forEach(prop => {
            Object.assign(result, this.getTablePropertyToStore(prop));
        });
        return result;
    }
    getTablePropertyToStore(property) {
        let result = {};
        switch (property) {
            case 'sort':
                result = this.getSortState();
                break;
            case 'columns-display':
                result = this.getColumnsDisplayState();
                break;
            case 'quick-filter':
                result = this.getColumnsQuickFilterState();
                break;
            case 'columns-filter':
                result = this.getColumnFiltersState();
                break;
            case 'page':
                result = this.getPageState();
                break;
            case 'selection':
                result = this.getSelectionState();
                break;
            case 'initial-configuration':
                result = this.getInitialConfigurationState();
                break;
            case 'filter-column-active-by-default':
                result = this.getFilterColumnActiveByDefaultState();
                break;
            case 'filter-columns':
                result = this.getFilterColumnsState();
                break;
        }
        return result;
    }
    getFilterColumnsState() {
        const result = {};
        if (this.table.state.hasOwnProperty('filter-columns') && this.table.state['filter-columns']) {
            result['filter-columns'] = this.table.state['filter-columns'];
        }
        else if (this.table.filterColumns) {
            result['filter-columns'] = this.table.filterColumns;
        }
        return result;
    }
    reset() {
        const state = {};
        state[OTableStorage.USER_STORED_FILTERS_KEY] = this.table.state[OTableStorage.USER_STORED_FILTERS_KEY];
        state[OTableStorage.STORED_CONFIGURATIONS_KEY] = this.table.state[OTableStorage.STORED_CONFIGURATIONS_KEY];
        if (this.table.pageable) {
            state.totalQueryRecordsNumber = this.table.state.totalQueryRecordsNumber;
        }
        state.currentPage = 0;
        this.table.state = state;
    }
    getSortState() {
        const result = {};
        const sortColumnsArray = this.table.sort.getSortColumns();
        if (sortColumnsArray.length > 0) {
            const sortColumns = [];
            sortColumnsArray.forEach(sortData => {
                sortColumns.push(sortData.id + Codes.COLUMNS_ALIAS_SEPARATOR + sortData.direction);
            });
            result['sort-columns'] = sortColumns.join(Codes.ARRAY_INPUT_SEPARATOR);
        }
        return result;
    }
    getFilterColumnActiveByDefaultState() {
        const result = {};
        if (this.table.oTableColumnsFilterComponent) {
            result['filter-column-active-by-default'] = this.table.showFilterByColumnIcon;
        }
        return result;
    }
    getColumnFiltersState() {
        const result = {};
        if (this.table.oTableColumnsFilterComponent) {
            const columnValueFilters = this.table.dataSource.getColumnValueFilters();
            if (columnValueFilters.length > 0) {
                result['column-value-filters'] = columnValueFilters;
            }
        }
        return result;
    }
    getColumnsDisplayState() {
        const result = {};
        const oColumnsData = [];
        this.table.oTableOptions.columns.forEach((oCol) => {
            oColumnsData.push({
                attr: oCol.attr,
                visible: oCol.visible,
                width: oCol.getWidthToStore()
            });
        });
        result['oColumns-display'] = oColumnsData;
        result['select-column-visible'] = this.table.oTableOptions.selectColumn.visible;
        return result;
    }
    getColumnsQuickFilterState() {
        const result = {};
        const tableOptions = this.table.oTableOptions;
        const oColumnsData = [];
        tableOptions.columns.forEach((oCol) => {
            oColumnsData.push({
                attr: oCol.attr,
                searchable: oCol.searchable,
                searching: oCol.searching
            });
        });
        result.oColumns = oColumnsData;
        result['filter-case-sensitive'] = tableOptions.filterCaseSensitive;
        return result;
    }
    getPageState() {
        const result = {
            'query-rows': this.table.matpaginator ? this.table.matpaginator.pageSize : ''
        };
        if (this.table.currentPage > 0 && this.table.storePaginationState) {
            result.currentPage = this.table.currentPage;
        }
        if (this.table.pageable && this.table.storePaginationState) {
            const state = this.table.state;
            result.totalQueryRecordsNumber = state.totalQueryRecordsNumber;
            result.queryRecordOffset = Math.max((state.queryRecordOffset - this.table.dataSource.renderedData.length), (state.queryRecordOffset - this.table.queryRows));
        }
        return result;
    }
    getSelectionState() {
        const result = {
            selection: []
        };
        if (this.table && this.table.keepSelectedItems) {
            const selection = [];
            this.table.getSelectedItems().forEach(item => {
                const data = {};
                this.table.getKeys().forEach(key => {
                    data[key] = item[key];
                });
                selection.push(data);
            });
            result.selection = selection;
        }
        return result;
    }
    getInitialConfigurationState() {
        let result = {};
        let initialConfiguration = {};
        let oColumnsData = [];
        const self = this;
        Util.parseArray(this.table.visibleColumns, true).forEach((x) => {
            let oCol = self.table.getOColumn(x);
            oColumnsData.push({
                attr: oCol.attr,
                visible: true,
                width: oCol.definition ? oCol.definition.originalWidth : undefined
            });
        });
        initialConfiguration['oColumns-display'] = oColumnsData;
        initialConfiguration['sort-columns'] = this.table.sortColumns;
        initialConfiguration['select-column-visible'] = this.table.oTableOptions.selectColumn.visible;
        initialConfiguration['filter-case-sensitive'] = this.table.filterCaseSensitive;
        initialConfiguration['query-rows'] = this.table.originalQueryRows;
        initialConfiguration['filter-column-active-by-default'] = this.table.originalFilterColumnActiveByDefault;
        initialConfiguration['filter-columns'] = this.table.originalFilterColumns;
        result['initial-configuration'] = initialConfiguration;
        return result;
    }
    setStoredFilters(filters) {
        return this.table.state[OTableStorage.USER_STORED_FILTERS_KEY] = filters;
    }
    getStoredFilters() {
        return this.table.state[OTableStorage.USER_STORED_FILTERS_KEY] || [];
    }
    getStoredFilter(filterName) {
        return this.getStoredFilters().find((item) => item.name === filterName);
    }
    getStoredFilterConf(filterName) {
        return (this.getStoredFilter(filterName) || {})[OTableStorage.STORED_FILTER_KEY];
    }
    deleteStoredFilter(filterName) {
        const storedFilters = this.table.state[OTableStorage.USER_STORED_FILTERS_KEY] || [];
        const index = storedFilters.findIndex((item) => item.name === filterName);
        if (index >= 0) {
            storedFilters.splice(index, 1);
            this.table.state[OTableStorage.USER_STORED_FILTERS_KEY] = storedFilters;
        }
    }
    storeFilter(filterArgs) {
        const result = {};
        const storedFilter = {};
        Object.assign(storedFilter, this.getColumnFiltersState());
        Object.assign(storedFilter, this.getColumnsQuickFilterState());
        result[OTableStorage.STORED_FILTER_KEY] = storedFilter;
        Object.assign(result, filterArgs);
        const existingFilters = this.getStoredFilters();
        existingFilters.push(result);
        this.table.state[OTableStorage.USER_STORED_FILTERS_KEY] = existingFilters;
    }
    getStoredColumnsFilters(arg) {
        const stateObj = arg || this.table.state;
        return stateObj['column-value-filters'] || [];
    }
    getStoredFiltersColumns(arg) {
        const stateObj = arg || this.table.state;
        return stateObj['filter-columns'] || [];
    }
    getStoredConfigurations() {
        return this.table.state[OTableStorage.STORED_CONFIGURATIONS_KEY] || [];
    }
    getStoredConfiguration(configurationName) {
        return this.getStoredConfigurations().find((item) => item.name === configurationName);
    }
    storeConfiguration(configurationAgs, tableProperties) {
        const result = {};
        this.table.storePaginationState = true;
        const storedConfiguration = this.getTablePropertiesToStore(tableProperties);
        this.table.storePaginationState = false;
        result[OTableStorage.STORED_CONFIGURATION_KEY] = storedConfiguration;
        Object.assign(result, configurationAgs);
        result[OTableStorage.STORED_PROPERTIES_KEY] = tableProperties;
        const existingConfigurations = this.getStoredConfigurations();
        existingConfigurations.push(result);
        this.table.state[OTableStorage.STORED_CONFIGURATIONS_KEY] = existingConfigurations;
    }
    deleteStoredConfiguration(configurationName) {
        const storedConfigurations = this.getStoredConfigurations();
        const index = storedConfigurations.findIndex((item) => item.name === configurationName);
        if (index >= 0) {
            storedConfigurations.splice(index, 1);
            this.table.state[OTableStorage.STORED_CONFIGURATIONS_KEY] = storedConfigurations;
        }
    }
}
OTableStorage.STORED_FILTER_KEY = 'stored-filter';
OTableStorage.USER_STORED_FILTERS_KEY = 'user-stored-filters';
OTableStorage.STORED_CONFIGURATION_KEY = 'stored-configuration';
OTableStorage.STORED_PROPERTIES_KEY = 'stored-properties';
OTableStorage.STORED_CONFIGURATIONS_KEY = 'user-stored-configurations';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiby10YWJsZS1zdG9yYWdlLmNsYXNzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vb250aW1pemUtd2ViLW5neC8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3RhYmxlL2V4dGVuc2lvbnMvby10YWJsZS1zdG9yYWdlLmNsYXNzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUVBLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1QyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFJMUMsTUFBTSxPQUFPLGFBQWE7SUFTeEIsWUFDWSxLQUFzQjtRQUF0QixVQUFLLEdBQUwsS0FBSyxDQUFpQjtJQUM5QixDQUFDO0lBRUwsY0FBYztRQUNaLE1BQU0sV0FBVyxHQUFHO1lBQ2xCLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLDBCQUEwQixDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRTtTQUNqRyxDQUFDO1FBRUYsTUFBTSxVQUFVLEdBQUcsQ0FBQyxNQUFNLEVBQUUsaUJBQWlCLEVBQUUsZ0JBQWdCLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsdUJBQXVCLEVBQUUsZ0JBQWdCLEVBQUUsaUNBQWlDLENBQUMsQ0FBQztRQUVwTCxNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMseUJBQXlCLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUV2RSxNQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ2pELElBQUksZ0JBQWdCLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUMvQixXQUFXLENBQUMsYUFBYSxDQUFDLHVCQUF1QixDQUFDLEdBQUcsZ0JBQWdCLENBQUM7U0FDdkU7UUFDRCxNQUFNLHVCQUF1QixHQUFHLElBQUksQ0FBQyx1QkFBdUIsRUFB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bEQsbUNBQXFCLEdBQUcsbUJBQW1CLENBQUM7QUFDNUMsdUNBQXlCLEdBQUcsNEJBQTRCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPVGFibGVDb25maWd1cmF0aW9uIH0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvby10YWJsZS1jb25maWd1cmF0aW9uLnR5cGUnO1xuaW1wb3J0IHsgT1RhYmxlRmlsdGVyc1N0YXR1cyB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL28tdGFibGUtZmlsdGVyLXN0YXR1cy50eXBlJztcbmltcG9ydCB7IENvZGVzIH0gZnJvbSAnLi4vLi4vLi4vdXRpbC9jb2Rlcyc7XG5pbXBvcnQgeyBVdGlsIH0gZnJvbSAnLi4vLi4vLi4vdXRpbC91dGlsJztcbmltcG9ydCB7IE9Db2x1bW4gfSBmcm9tICcuLi9jb2x1bW4vby1jb2x1bW4uY2xhc3MnO1xuaW1wb3J0IHsgT1RhYmxlQ29tcG9uZW50IH0gZnJvbSAnLi4vby10YWJsZS5jb21wb25lbnQnO1xuXG5leHBvcnQgY2xhc3MgT1RhYmxlU3RvcmFnZSB7XG5cbiAgcHVibGljIHN0YXRpYyBTVE9SRURfRklMVEVSX0tFWSA9ICdzdG9yZWQtZmlsdGVyJztcbiAgcHVibGljIHN0YXRpYyBVU0VSX1NUT1JFRF9GSUxURVJTX0tFWSA9ICd1c2VyLXN0b3JlZC1maWx0ZXJzJztcblxuICBwdWJsaWMgc3RhdGljIFNUT1JFRF9DT05GSUdVUkFUSU9OX0tFWSA9ICdzdG9yZWQtY29uZmlndXJhdGlvbic7XG4gIHB1YmxpYyBzdGF0aWMgU1RPUkVEX1BST1BFUlRJRVNfS0VZID0gJ3N0b3JlZC1wcm9wZXJ0aWVzJztcbiAgcHVibGljIHN0YXRpYyBTVE9SRURfQ09ORklHVVJBVElPTlNfS0VZID0gJ3VzZXItc3RvcmVkLWNvbmZpZ3VyYXRpb25zJztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgdGFibGU6IE9UYWJsZUNvbXBvbmVudFxuICApIHsgfVxuXG4gIGdldERhdGFUb1N0b3JlKCkge1xuICAgIGNvbnN0IGRhdGFUb1N0b3JlID0ge1xuICAgICAgZmlsdGVyOiB0aGlzLnRhYmxlLm9UYWJsZVF1aWNrRmlsdGVyQ29tcG9uZW50ID8gdGhpcy50YWJsZS5vVGFibGVRdWlja0ZpbHRlckNvbXBvbmVudC52YWx1ZSA6ICcnXG4gICAgfTtcblxuICAgIGNvbnN0IHByb3BlcnRpZXMgPSBbJ3NvcnQnLCAnY29sdW1ucy1kaXNwbGF5JywgJ2NvbHVtbnMtZmlsdGVyJywgJ3F1aWNrLWZpbHRlcicsICdwYWdlJywgJ3NlbGVjdGlvbicsICdpbml0aWFsLWNvbmZpZ3VyYXRpb24nLCAnZmlsdGVyLWNvbHVtbnMnLCAnZmlsdGVyLWNvbHVtbi1hY3RpdmUtYnktZGVmYXVsdCddO1xuICAgIFxuICAgIE9iamVjdC5hc3NpZ24oZGF0YVRvU3RvcmUsIHRoaXMuZ2V0VGFibGVQcm9wZXJ0aWVzVG9TdG9yZShwcm9wZXJ0aWVzKSk7XG5cbiAgICBjb25zdCBzdG9yZWRGaWx0ZXJzQXJyID0gdGhpcy5nZXRTdG9yZWRGaWx0ZXJzKCk7XG4gICAgaWYgKHN0b3JlZEZpbHRlcnNBcnIubGVuZ3RoID4gMCkge1xuICAgICAgZGF0YVRvU3RvcmVbT1RhYmxlU3RvcmFnZS5VU0VSX1NUT1JFRF9GSUxURVJTX0tFWV0gPSBzdG9yZWRGaWx0ZXJzQXJyO1xuICAgIH1cbiAgICBjb25zdCBzdG9yZWRDb25maWd1cmF0aW9uc0FyciA9IHRoaXMuZ2V0U3RvcmVkQ29uZmlndXJhdGlvbnMoKTtcbiAgICBpZiAoc3RvcmVkQ29uZmlndXJhdGlvbnNBcnIubGVuZ3RoID4gMCkge1xuICAgICAgZGF0YVRvU3RvcmVbT1RhYmxlU3RvcmFnZS5TVE9SRURfQ09ORklHVVJBVElPTlNfS0VZXSA9IHN0b3JlZENvbmZpZ3VyYXRpb25zQXJyO1xuICAgIH1cblxuICAgIHJldHVybiBkYXRhVG9TdG9yZTtcbiAgfVxuXG4gIGdldFRhYmxlUHJvcGVydGllc1RvU3RvcmUocHJvcGVydGllczogc3RyaW5nW10pIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2gocHJvcCA9PiB7XG4gICAgICBPYmplY3QuYXNzaWduKHJlc3VsdCwgdGhpcy5nZXRUYWJsZVByb3BlcnR5VG9TdG9yZShwcm9wKSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGdldFRhYmxlUHJvcGVydHlUb1N0b3JlKHByb3BlcnR5OiBzdHJpbmcpIHtcbiAgICBsZXQgcmVzdWx0ID0ge307XG4gICAgc3dpdGNoIChwcm9wZXJ0eSkge1xuICAgICAgY2FzZSAnc29ydCc6XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuZ2V0U29ydFN0YXRlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnY29sdW1ucy1kaXNwbGF5JzpcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5nZXRDb2x1bW5zRGlzcGxheVN0YXRlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncXVpY2stZmlsdGVyJzpcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5nZXRDb2x1bW5zUXVpY2tGaWx0ZXJTdGF0ZSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2NvbHVtbnMtZmlsdGVyJzpcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5nZXRDb2x1bW5GaWx0ZXJzU3RhdGUoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdwYWdlJzpcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5nZXRQYWdlU3RhdGUoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzZWxlY3Rpb24nOlxuICAgICAgICByZXN1bHQgPSB0aGlzLmdldFNlbGVjdGlvblN0YXRlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnaW5pdGlhbC1jb25maWd1cmF0aW9uJzpcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5nZXRJbml0aWFsQ29uZmlndXJhdGlvblN0YXRlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZmlsdGVyLWNvbHVtbi1hY3RpdmUtYnktZGVmYXVsdCc6XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuZ2V0RmlsdGVyQ29sdW1uQWN0aXZlQnlEZWZhdWx0U3RhdGUoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdmaWx0ZXItY29sdW1ucyc6XG4gICAgICAgIHJlc3VsdCA9IHRoaXMuZ2V0RmlsdGVyQ29sdW1uc1N0YXRlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgZ2V0RmlsdGVyQ29sdW1uc1N0YXRlKCk6IGFueSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgaWYgKHRoaXMudGFibGUuc3RhdGUuaGFzT3duUHJvcGVydHkoJ2ZpbHRlci1jb2x1bW5zJykgJiYgdGhpcy50YWJsZS5zdGF0ZVsnZmlsdGVyLWNvbHVtbnMnXSkge1xuICAgICAgcmVzdWx0WydmaWx0ZXItY29sdW1ucyddID0gdGhpcy50YWJsZS5zdGF0ZVsnZmlsdGVyLWNvbHVtbnMnXTtcbiAgICB9IGVsc2UgaWYgKHRoaXMudGFibGUuZmlsdGVyQ29sdW1ucykge1xuICAgICAgcmVzdWx0WydmaWx0ZXItY29sdW1ucyddID0gdGhpcy50YWJsZS5maWx0ZXJDb2x1bW5zO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICByZXNldCgpIHtcbiAgICBjb25zdCBzdGF0ZTogYW55ID0ge307XG4gICAgc3RhdGVbT1RhYmxlU3RvcmFnZS5VU0VSX1NUT1JFRF9GSUxURVJTX0tFWV0gPSB0aGlzLnRhYmxlLnN0YXRlW09UYWJsZVN0b3JhZ2UuVVNFUl9TVE9SRURfRklMVEVSU19LRVldO1xuICAgIHN0YXRlW09UYWJsZVN0b3JhZ2UuU1RPUkVEX0NPTkZJR1VSQVRJT05TX0tFWV0gPSB0aGlzLnRhYmxlLnN0YXRlW09UYWJsZVN0b3JhZ2UuU1RPUkVEX0NPTkZJR1VSQVRJT05TX0tFWV07XG4gICAgaWYgKHRoaXMudGFibGUucGFnZWFibGUpIHtcbiAgICAgIHN0YXRlLnRvdGFsUXVlcnlSZWNvcmRzTnVtYmVyID0gdGhpcy50YWJsZS5zdGF0ZS50b3RhbFF1ZXJ5UmVjb3Jkc051bWJlcjtcbiAgICB9XG4gICAgc3RhdGUuY3VycmVudFBhZ2UgPSAwO1xuICAgIHRoaXMudGFibGUuc3RhdGUgPSBzdGF0ZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRTb3J0U3RhdGUoKSB7XG4gICAgY29uc3QgcmVzdWx0ID0ge307XG4gICAgY29uc3Qgc29ydENvbHVtbnNBcnJheSA9IHRoaXMudGFibGUuc29ydC5nZXRTb3J0Q29sdW1ucygpO1xuICAgIGlmIChzb3J0Q29sdW1uc0FycmF5Lmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IHNvcnRDb2x1bW5zID0gW107XG4gICAgICBzb3J0Q29sdW1uc0FycmF5LmZvckVhY2goc29ydERhdGEgPT4ge1xuICAgICAgICBzb3J0Q29sdW1ucy5wdXNoKHNvcnREYXRhLmlkICsgQ29kZXMuQ09MVU1OU19BTElBU19TRVBBUkFUT1IgKyBzb3J0RGF0YS5kaXJlY3Rpb24pO1xuICAgICAgfSk7XG4gICAgICByZXN1bHRbJ3NvcnQtY29sdW1ucyddID0gc29ydENvbHVtbnMuam9pbihDb2Rlcy5BUlJBWV9JTlBVVF9TRVBBUkFUT1IpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldEZpbHRlckNvbHVtbkFjdGl2ZUJ5RGVmYXVsdFN0YXRlKCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgIGlmICh0aGlzLnRhYmxlLm9UYWJsZUNvbHVtbnNGaWx0ZXJDb21wb25lbnQpIHtcbiAgICAgIHJlc3VsdFsnZmlsdGVyLWNvbHVtbi1hY3RpdmUtYnktZGVmYXVsdCddID0gdGhpcy50YWJsZS5zaG93RmlsdGVyQnlDb2x1bW5JY29uO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldENvbHVtbkZpbHRlcnNTdGF0ZSgpIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBpZiAodGhpcy50YWJsZS5vVGFibGVDb2x1bW5zRmlsdGVyQ29tcG9uZW50KSB7XG4gICAgICBjb25zdCBjb2x1bW5WYWx1ZUZpbHRlcnMgPSB0aGlzLnRhYmxlLmRhdGFTb3VyY2UuZ2V0Q29sdW1uVmFsdWVGaWx0ZXJzKCk7XG4gICAgICBpZiAoY29sdW1uVmFsdWVGaWx0ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmVzdWx0Wydjb2x1bW4tdmFsdWUtZmlsdGVycyddID0gY29sdW1uVmFsdWVGaWx0ZXJzO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cblxuICBwcm90ZWN0ZWQgZ2V0Q29sdW1uc0Rpc3BsYXlTdGF0ZSgpIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBjb25zdCBvQ29sdW1uc0RhdGEgPSBbXTtcbiAgICB0aGlzLnRhYmxlLm9UYWJsZU9wdGlvbnMuY29sdW1ucy5mb3JFYWNoKChvQ29sOiBPQ29sdW1uKSA9PiB7XG4gICAgICBvQ29sdW1uc0RhdGEucHVzaCh7XG4gICAgICAgIGF0dHI6IG9Db2wuYXR0cixcbiAgICAgICAgdmlzaWJsZTogb0NvbC52aXNpYmxlLFxuICAgICAgICB3aWR0aDogb0NvbC5nZXRXaWR0aFRvU3RvcmUoKVxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmVzdWx0WydvQ29sdW1ucy1kaXNwbGF5J10gPSBvQ29sdW1uc0RhdGE7XG4gICAgcmVzdWx0WydzZWxlY3QtY29sdW1uLXZpc2libGUnXSA9IHRoaXMudGFibGUub1RhYmxlT3B0aW9ucy5zZWxlY3RDb2x1bW4udmlzaWJsZTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldENvbHVtbnNRdWlja0ZpbHRlclN0YXRlKCkge1xuICAgIGNvbnN0IHJlc3VsdDogYW55ID0ge307XG4gICAgY29uc3QgdGFibGVPcHRpb25zID0gdGhpcy50YWJsZS5vVGFibGVPcHRpb25zO1xuICAgIGNvbnN0IG9Db2x1bW5zRGF0YSA9IFtdO1xuICAgIHRhYmxlT3B0aW9ucy5jb2x1bW5zLmZvckVhY2goKG9Db2w6IE9Db2x1bW4pID0+IHtcbiAgICAgIG9Db2x1bW5zRGF0YS5wdXNoKHtcbiAgICAgICAgYXR0cjogb0NvbC5hdHRyLFxuICAgICAgICBzZWFyY2hhYmxlOiBvQ29sLnNlYXJjaGFibGUsXG4gICAgICAgIHNlYXJjaGluZzogb0NvbC5zZWFyY2hpbmdcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJlc3VsdC5vQ29sdW1ucyA9IG9Db2x1bW5zRGF0YTtcbiAgICByZXN1bHRbJ2ZpbHRlci1jYXNlLXNlbnNpdGl2ZSddID0gdGFibGVPcHRpb25zLmZpbHRlckNhc2VTZW5zaXRpdmU7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRQYWdlU3RhdGUoKTogYW55IHtcbiAgICBjb25zdCByZXN1bHQ6IGFueSA9IHtcbiAgICAgICdxdWVyeS1yb3dzJzogdGhpcy50YWJsZS5tYXRwYWdpbmF0b3IgPyB0aGlzLnRhYmxlLm1hdHBhZ2luYXRvci5wYWdlU2l6ZSA6ICcnXG4gICAgfTtcbiAgICBpZiAodGhpcy50YWJsZS5jdXJyZW50UGFnZSA+IDAgJiYgdGhpcy50YWJsZS5zdG9yZVBhZ2luYXRpb25TdGF0ZSkge1xuICAgICAgcmVzdWx0LmN1cnJlbnRQYWdlID0gdGhpcy50YWJsZS5jdXJyZW50UGFnZTtcbiAgICB9XG4gICAgaWYgKHRoaXMudGFibGUucGFnZWFibGUgJiYgdGhpcy50YWJsZS5zdG9yZVBhZ2luYXRpb25TdGF0ZSkge1xuICAgICAgY29uc3Qgc3RhdGUgPSB0aGlzLnRhYmxlLnN0YXRlO1xuICAgICAgcmVzdWx0LnRvdGFsUXVlcnlSZWNvcmRzTnVtYmVyID0gc3RhdGUudG90YWxRdWVyeVJlY29yZHNOdW1iZXI7XG4gICAgICByZXN1bHQucXVlcnlSZWNvcmRPZmZzZXQgPSBNYXRoLm1heChcbiAgICAgICAgKHN0YXRlLnF1ZXJ5UmVjb3JkT2Zmc2V0IC0gdGhpcy50YWJsZS5kYXRhU291cmNlLnJlbmRlcmVkRGF0YS5sZW5ndGgpLFxuICAgICAgICAoc3RhdGUucXVlcnlSZWNvcmRPZmZzZXQgLSB0aGlzLnRhYmxlLnF1ZXJ5Um93cylcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0U2VsZWN0aW9uU3RhdGUoKTogYW55IHtcbiAgICBjb25zdCByZXN1bHQ6IGFueSA9IHtcbiAgICAgIHNlbGVjdGlvbjogW11cbiAgICB9O1xuICAgIGlmICh0aGlzLnRhYmxlICYmIHRoaXMudGFibGUua2VlcFNlbGVjdGVkSXRlbXMpIHtcbiAgICAgIC8vIHN0b3Jpbmcgc2VsZWN0ZWQgaXRlbXMga2V5cyB2YWx1ZXNcbiAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IFtdO1xuICAgICAgdGhpcy50YWJsZS5nZXRTZWxlY3RlZEl0ZW1zKCkuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHt9O1xuICAgICAgICB0aGlzLnRhYmxlLmdldEtleXMoKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgICAgZGF0YVtrZXldID0gaXRlbVtrZXldO1xuICAgICAgICB9KTtcbiAgICAgICAgc2VsZWN0aW9uLnB1c2goZGF0YSk7XG4gICAgICB9KTtcbiAgICAgIHJlc3VsdC5zZWxlY3Rpb24gPSBzZWxlY3Rpb247XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0SW5pdGlhbENvbmZpZ3VyYXRpb25TdGF0ZSgpOiBhbnkge1xuICAgIGxldCByZXN1bHQgPSB7fTtcbiAgICBsZXQgaW5pdGlhbENvbmZpZ3VyYXRpb24gPSB7fTtcblxuICAgIGxldCBvQ29sdW1uc0RhdGEgPSBbXTtcbiAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICBVdGlsLnBhcnNlQXJyYXkodGhpcy50YWJsZS52aXNpYmxlQ29sdW1ucywgdHJ1ZSkuZm9yRWFjaCgoeDogc3RyaW5nKSA9PiB7XG4gICAgICBsZXQgb0NvbCA9IHNlbGYudGFibGUuZ2V0T0NvbHVtbih4KTtcbiAgICAgIG9Db2x1bW5zRGF0YS5wdXNoKHtcbiAgICAgICAgYXR0cjogb0NvbC5hdHRyLFxuICAgICAgICB2aXNpYmxlOiB0cnVlLFxuICAgICAgICB3aWR0aDogb0NvbC5kZWZpbml0aW9uID8gb0NvbC5kZWZpbml0aW9uLm9yaWdpbmFsV2lkdGggOiB1bmRlZmluZWRcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaW5pdGlhbENvbmZpZ3VyYXRpb25bJ29Db2x1bW5zLWRpc3BsYXknXSA9IG9Db2x1bW5zRGF0YTtcbiAgICBpbml0aWFsQ29uZmlndXJhdGlvblsnc29ydC1jb2x1bW5zJ10gPSB0aGlzLnRhYmxlLnNvcnRDb2x1bW5zO1xuICAgIGluaXRpYWxDb25maWd1cmF0aW9uWydzZWxlY3QtY29sdW1uLXZpc2libGUnXSA9IHRoaXMudGFibGUub1RhYmxlT3B0aW9ucy5zZWxlY3RDb2x1bW4udmlzaWJsZTtcbiAgICBpbml0aWFsQ29uZmlndXJhdGlvblsnZmlsdGVyLWNhc2Utc2Vuc2l0aXZlJ10gPSB0aGlzLnRhYmxlLmZpbHRlckNhc2VTZW5zaXRpdmU7XG4gICAgaW5pdGlhbENvbmZpZ3VyYXRpb25bJ3F1ZXJ5LXJvd3MnXSA9IHRoaXMudGFibGUub3JpZ2luYWxRdWVyeVJvd3M7XG4gICAgaW5pdGlhbENvbmZpZ3VyYXRpb25bJ2ZpbHRlci1jb2x1bW4tYWN0aXZlLWJ5LWRlZmF1bHQnXSA9IHRoaXMudGFibGUub3JpZ2luYWxGaWx0ZXJDb2x1bW5BY3RpdmVCeURlZmF1bHQ7XG4gICAgaW5pdGlhbENvbmZpZ3VyYXRpb25bJ2ZpbHRlci1jb2x1bW5zJ10gPSB0aGlzLnRhYmxlLm9yaWdpbmFsRmlsdGVyQ29sdW1ucztcblxuICAgIHJlc3VsdFsnaW5pdGlhbC1jb25maWd1cmF0aW9uJ10gPSBpbml0aWFsQ29uZmlndXJhdGlvbjtcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBzZXRTdG9yZWRGaWx0ZXJzKGZpbHRlcnM6IEFycmF5PE9UYWJsZUZpbHRlcnNTdGF0dXM+KSB7XG4gICAgcmV0dXJuIHRoaXMudGFibGUuc3RhdGVbT1RhYmxlU3RvcmFnZS5VU0VSX1NUT1JFRF9GSUxURVJTX0tFWV0gPSBmaWx0ZXJzO1xuICB9XG5cbiAgZ2V0U3RvcmVkRmlsdGVycygpIHtcbiAgICByZXR1cm4gdGhpcy50YWJsZS5zdGF0ZVtPVGFibGVTdG9yYWdlLlVTRVJfU1RPUkVEX0ZJTFRFUlNfS0VZXSB8fCBbXTtcbiAgfVxuXG4gIGdldFN0b3JlZEZpbHRlcihmaWx0ZXJOYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdG9yZWRGaWx0ZXJzKCkuZmluZCgoaXRlbTogT1RhYmxlRmlsdGVyc1N0YXR1cykgPT4gaXRlbS5uYW1lID09PSBmaWx0ZXJOYW1lKTtcbiAgfVxuXG4gIGdldFN0b3JlZEZpbHRlckNvbmYoZmlsdGVyTmFtZTogc3RyaW5nKSB7XG4gICAgcmV0dXJuICh0aGlzLmdldFN0b3JlZEZpbHRlcihmaWx0ZXJOYW1lKSB8fCB7fSlbT1RhYmxlU3RvcmFnZS5TVE9SRURfRklMVEVSX0tFWV07XG4gIH1cblxuICBkZWxldGVTdG9yZWRGaWx0ZXIoZmlsdGVyTmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3Qgc3RvcmVkRmlsdGVycyA9IHRoaXMudGFibGUuc3RhdGVbT1RhYmxlU3RvcmFnZS5VU0VSX1NUT1JFRF9GSUxURVJTX0tFWV0gfHwgW107XG4gICAgY29uc3QgaW5kZXggPSBzdG9yZWRGaWx0ZXJzLmZpbmRJbmRleCgoaXRlbTogT1RhYmxlRmlsdGVyc1N0YXR1cykgPT4gaXRlbS5uYW1lID09PSBmaWx0ZXJOYW1lKTtcbiAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgc3RvcmVkRmlsdGVycy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgdGhpcy50YWJsZS5zdGF0ZVtPVGFibGVTdG9yYWdlLlVTRVJfU1RPUkVEX0ZJTFRFUlNfS0VZXSA9IHN0b3JlZEZpbHRlcnM7XG4gICAgfVxuICB9XG5cbiAgc3RvcmVGaWx0ZXIoZmlsdGVyQXJnczogT1RhYmxlRmlsdGVyc1N0YXR1cykge1xuICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgIGNvbnN0IHN0b3JlZEZpbHRlciA9IHt9O1xuICAgIE9iamVjdC5hc3NpZ24oc3RvcmVkRmlsdGVyLCB0aGlzLmdldENvbHVtbkZpbHRlcnNTdGF0ZSgpKTtcbiAgICBPYmplY3QuYXNzaWduKHN0b3JlZEZpbHRlciwgdGhpcy5nZXRDb2x1bW5zUXVpY2tGaWx0ZXJTdGF0ZSgpKTtcblxuICAgIHJlc3VsdFtPVGFibGVTdG9yYWdlLlNUT1JFRF9GSUxURVJfS0VZXSA9IHN0b3JlZEZpbHRlcjtcbiAgICBPYmplY3QuYXNzaWduKHJlc3VsdCwgZmlsdGVyQXJncyk7XG4gICAgY29uc3QgZXhpc3RpbmdGaWx0ZXJzID0gdGhpcy5nZXRTdG9yZWRGaWx0ZXJzKCk7XG4gICAgZXhpc3RpbmdGaWx0ZXJzLnB1c2gocmVzdWx0KTtcbiAgICB0aGlzLnRhYmxlLnN0YXRlW09UYWJsZVN0b3JhZ2UuVVNFUl9TVE9SRURfRklMVEVSU19LRVldID0gZXhpc3RpbmdGaWx0ZXJzO1xuICB9XG5cbiAgZ2V0U3RvcmVkQ29sdW1uc0ZpbHRlcnMoYXJnPzogYW55KSB7XG4gICAgY29uc3Qgc3RhdGVPYmogPSBhcmcgfHwgdGhpcy50YWJsZS5zdGF0ZTtcbiAgICByZXR1cm4gc3RhdGVPYmpbJ2NvbHVtbi12YWx1ZS1maWx0ZXJzJ10gfHwgW107XG4gIH1cblxuICBnZXRTdG9yZWRGaWx0ZXJzQ29sdW1ucyhhcmc/OiBhbnkpIHtcbiAgICBjb25zdCBzdGF0ZU9iaiA9IGFyZyB8fCB0aGlzLnRhYmxlLnN0YXRlO1xuICAgIHJldHVybiBzdGF0ZU9ialsnZmlsdGVyLWNvbHVtbnMnXSB8fCBbXTtcbiAgfVxuXG4gIGdldFN0b3JlZENvbmZpZ3VyYXRpb25zKCkge1xuICAgIHJldHVybiB0aGlzLnRhYmxlLnN0YXRlW09UYWJsZVN0b3JhZ2UuU1RPUkVEX0NPTkZJR1VSQVRJT05TX0tFWV0gfHwgW107XG4gIH1cblxuICBnZXRTdG9yZWRDb25maWd1cmF0aW9uKGNvbmZpZ3VyYXRpb25OYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdG9yZWRDb25maWd1cmF0aW9ucygpLmZpbmQoKGl0ZW06IE9UYWJsZUNvbmZpZ3VyYXRpb24pID0+IGl0ZW0ubmFtZSA9PT0gY29uZmlndXJhdGlvbk5hbWUpO1xuICB9XG5cbiAgc3RvcmVDb25maWd1cmF0aW9uKGNvbmZpZ3VyYXRpb25BZ3M6IE9UYWJsZUNvbmZpZ3VyYXRpb24sIHRhYmxlUHJvcGVydGllczogYW55W10pIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICB0aGlzLnRhYmxlLnN0b3JlUGFnaW5hdGlvblN0YXRlID0gdHJ1ZTtcbiAgICBjb25zdCBzdG9yZWRDb25maWd1cmF0aW9uID0gdGhpcy5nZXRUYWJsZVByb3BlcnRpZXNUb1N0b3JlKHRhYmxlUHJvcGVydGllcyk7XG4gICAgdGhpcy50YWJsZS5zdG9yZVBhZ2luYXRpb25TdGF0ZSA9IGZhbHNlO1xuXG4gICAgcmVzdWx0W09UYWJsZVN0b3JhZ2UuU1RPUkVEX0NPTkZJR1VSQVRJT05fS0VZXSA9IHN0b3JlZENvbmZpZ3VyYXRpb247XG4gICAgT2JqZWN0LmFzc2lnbihyZXN1bHQsIGNvbmZpZ3VyYXRpb25BZ3MpO1xuICAgIHJlc3VsdFtPVGFibGVTdG9yYWdlLlNUT1JFRF9QUk9QRVJUSUVTX0tFWV0gPSB0YWJsZVByb3BlcnRpZXM7XG4gICAgY29uc3QgZXhpc3RpbmdDb25maWd1cmF0aW9ucyA9IHRoaXMuZ2V0U3RvcmVkQ29uZmlndXJhdGlvbnMoKTtcbiAgICBleGlzdGluZ0NvbmZpZ3VyYXRpb25zLnB1c2gocmVzdWx0KTtcbiAgICB0aGlzLnRhYmxlLnN0YXRlW09UYWJsZVN0b3JhZ2UuU1RPUkVEX0NPTkZJR1VSQVRJT05TX0tFWV0gPSBleGlzdGluZ0NvbmZpZ3VyYXRpb25zO1xuICB9XG5cbiAgZGVsZXRlU3RvcmVkQ29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uTmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3Qgc3RvcmVkQ29uZmlndXJhdGlvbnMgPSB0aGlzLmdldFN0b3JlZENvbmZpZ3VyYXRpb25zKCk7XG4gICAgY29uc3QgaW5kZXggPSBzdG9yZWRDb25maWd1cmF0aW9ucy5maW5kSW5kZXgoKGl0ZW06IE9UYWJsZUNvbmZpZ3VyYXRpb24pID0+IGl0ZW0ubmFtZSA9PT0gY29uZmlndXJhdGlvbk5hbWUpO1xuICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICBzdG9yZWRDb25maWd1cmF0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgdGhpcy50YWJsZS5zdGF0ZVtPVGFibGVTdG9yYWdlLlNUT1JFRF9DT05GSUdVUkFUSU9OU19LRVldID0gc3RvcmVkQ29uZmlndXJhdGlvbnM7XG4gICAgfVxuICB9XG5cbn1cbiJdfQ==